<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>终止申请</title>
    <link rel="stylesheet" type="text/css" media="screen" href="../../../../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../../../layui/css/layui.css">
</head>
<body>
<div style="position: fixed;top: 0;width: 100%;height: 60px;background-color: white;z-index: 1;">
    <div style="position: absolute;right: 30px;top: 15px;">
        <button type="button" class="layui-btn layui-btn-sm" onclick="submit();">提交</button>
        <button type="button" class="layui-btn layui-btn-sm" onclick="history.back(-1);">返回</button>
    </div>
</div>
<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" style="margin-top: 60px;">
    <form class="form-horizontal" onsubmit="return false" id="form">
        <fieldset>
            <div class="form-group">
                <label class="col-md-2 control-label">项目名称</label>
                <div class="col-md-3">
                    <input class="form-control" type="text" name="name" readonly>
                </div>
                <label class="col-md-1 control-label">计划类别</label>
                <div class="col-md-3">
                    <input class="form-control" type="text" name="type" readonly>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label">原因描述</label>
                <div class="col-md-7">
							<textarea class="layui-textarea" name="remark" style="border-color: #ccc;"
                                      data-bv-notempty="true"
                                      data-bv-notempty-message=" 内容不能为空"></textarea>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label">
                    <button type="button" class="layui-btn layui-btn-normal" id="files">选择多文件</button>
                </label>
                <div class="col-md-7">
                    <div class="layui-upload-list">
                        <table class="layui-table">
                            <thead>
                            <tr>
                                <th>文件名</th>
                                <th>操作</th>
                            </tr>
                            </thead>
                            <tbody id="filesList">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </fieldset>
    </form>
</div>
</body>
<script type="text/javascript" src="../../../../js/libs/jquery-3.3.1.min.js"></script>
<script src="../../../../js/constant.js"></script>
<script type="text/javascript" src="../../../../js/jq.js"></script>
<script type="text/javascript" src="../../../../js/common.js"></script>
<script type="text/javascript" src="../../../../js/my/permission.js"></script>
<script type="text/javascript" src="../../../../layui/layui.js"></script>
<script type="text/javascript" src="../../../../js/plugin/bootstrapvalidator/bootstrapValidator.min.js"></script>

<!--<script src="http://www.jq22.com/jquery/jquery-1.10.2.js"></script>-->
<script type="text/javascript" src="../../js/jquery.media.js"></script>
<script>
    var accessorys = '';
    layui.use('upload', function () {
        var $ = layui.jquery,
            upload = layui.upload;
        //文件上传
        var uploadInst = upload.render({
            elem: '#files' //绑定元素
            , accept: 'file'
            , url: domainName + '/zuul/api-f/files' //上传接口
            , done: function (res) {
                //上传完毕回调
                var str = '<tr> <td>' + res.name + '</td>\n' +
                    '<td>\n' +
                    '<a class="layui-btn layui-btn-xs demo-reload" id="handout_wrap_inner" href="'+res.url+'" target="_blank">打开</a>\n' +
                    /*'<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>\n' +*/
                    '</td>\n' +
                    '</tr>';
                $('#filesList').append(str);
                accessorys += ','+res.id;
            }
            , error: function () {
                //请求异常回调
            }
        });
    });

    var id = getUrlParam("itemId");
    getItem();

    function getItem() {
        $.ajax({
            type: 'get',
            url: domainName + '/project-item/item/information/list',
            data: "id=" + id,
            async: false,
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var d = data[0];
                $('input[name=type]').val(analysisLablename(d.type));
                $('input[name=name]').val(d.name);
            }
        })
    }

    /*解析标签名称*/
    function analysisLablename(sign) {
        var text = '';
        $.ajax({
            type: 'get',
            url: domainName + '/api-label/label/tree/' + sign,
            async: false,
            success: function (data) {
                text = data[0].content;
            }
        });
        return text;
    }

    function submit() {
        $('#form').bootstrapValidator();
        var bootstrapValidator = $("#form").data('bootstrapValidator');
        bootstrapValidator.validate();
        if (!bootstrapValidator.isValid()) {
            return;
        }
        var formdata = $("#form").serializeObject();
        formdata.item_id = id;
        formdata.accessorys = accessorys;
        $.ajax({
            type: 'post',
            url: domainName + '/project-item/item/termination',
            contentType: "application/json; charset=utf-8",
            async: false,
            data: JSON.stringify(formdata),
            success: function (data) {
                layer.msg("成功", {shift: -1, time: 1000}, function () {
                });
            }
        });
    }

    $('#handout_wrap_inner').media({
        width: '80%',
        height: '80%',
        autoplay: true,
    });
</script>
</html>
