<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../layui/css/layui.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../item/css/newProjecy.css">
    <style>
        .layui-table td {
            position: initial;
        }

        .layui-textarea {
            min-height: 60px;
        }

    </style>
</head>
<body>

<div class="layui-form" style="margin-top: 60px;">
    <table class="layui-table" lay-skin="nob" style="border-collapse: separate;">
        <colgroup>
            <col width="8%">
            <col width="3%">
            <col width="10%">
            <col width="28%">
            <col width="2%">
            <col width="10%">
            <col width="20">
            <col width="8%">
            <col width="3%">
            <col width="8%">
        </colgroup>
        <tbody>
        <!--基本信息-->
        <form id="form1">
            <tr style="height: 40px;">
                <td class="mainTd_0" rowspan="1" colspan="1"></td>
                <td class="mainTd_1" rowspan="1" colspan="1"></td>
                <td class="mainTd_1" rowspan="1" colspan="1">
                    <div class="field">
                        <span>建议查定时间</span>
                    </div>
                </td>
                <td class="mainTd_1 tdDorder" rowspan="1" colspan="1">
                    <div class="field">
                        <span name="period" id="period"></span>
                    </div>
                </td>

            </tr>

            <tr style="height: 24px;">
                <td class="mainTd_0" rowspan="1" colspan="1"></td>
                <td class="mainTd_1" rowspan="1" colspan="8"></td>
                <td class="mainTd_0" rowspan="1" colspan="1"></td>
            </tr>
            <tr style="height: 40px;">
                <td class="mainTd_0" rowspan="1" colspan="1"></td>
                <td class="mainTd_1" rowspan="1" colspan="1"></td>
                <td class="mainTd_1" rowspan="1" colspan="1">
                    <div class="field">
                        <span>申请说明</span>
                    </div>
                </td>
                <td class="mainTd_1 tdDorder" rowspan="1" colspan="5">
                    <div class="field">
                        <textarea name="content" id="content" placeholder="请输入内容" class="layui-textarea" readonly></textarea>
                    </div>
                </td>
                <td class="mainTd_1" rowspan="1" colspan="1"></td>
                <td class="mainTd_0" rowspan="1" colspan="1"></td>
            </tr>
        </form>
        <!--项目考核指标-->
        <tr style="height: 24px;">
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="8"></td>
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
        </tr>
        <tr style="height: 40px;">
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="6">
                <div class="indicators">
                    <form>
                        <table class="layui-table">
                            <colgroup>
                                <col width="10%">
                                <col width="60%">
                                <col width="30%">
                            </colgroup>
                            <thead>
                            <tr style="background-color: #ffffff;">
                                <th class="tdDorder border-right-none" rowspan="1" colspan="3">
                                    <div class="field">
                                        <span id="target">查定指标</span>
                                    </div>
                                </th>
                            </tr>
                            <tr>
                                <th class="tdDorder">序号</th>
                                <th class="tdDorder">指标内容</th>
                                <th class="tdDorder">查定地址</th>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </form>
                </div>
            </td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
        </tr>

        </tbody>
    </table>

</div>

<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <form class="form-horizontal" onsubmit="return false" id="form" style="padding-bottom: 30px;margin-top: 20px">
        <fieldset>
            <div class="form-group">
                <input style="display: none" id="check_userid" name="check_userid" value="">

                <input style="display: none" id="id" name="id" value="">
                <label class="col-md-2 control-label">实际查定时间</label>
                <div class="col-md-3">
                    <input type="text" name="periods" id="periods" placeholder="请输入" class="form-control date" readonly>
                </div>

                <label class="col-md-2 control-label">查定结果</label>
                <div class="col-md-3">
                    <p name="result" id="result" style=""></p>
                    <!--<input type="text" name="result" id="result" placeholder="请输入" class="form-control date">-->
                </div>
            </div>


            <div class="form-group">
                <label class="col-md-2 control-label">查定情况简述:</label>
                <div class="col-md-8">
                    <textarea placeholder="查定情况简述。"
                              class="layui-textarea form-control" lay-verify="required"
                              id="description" name="description" data-bv-notempty="true"
                              data-bv-notempty-message="查定情况简述 不能为空"></textarea>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label">查定目的:</label>
                <div class="col-md-8">
                    <textarea placeholder="查定目的。"
                              class="layui-textarea form-control" lay-verify="required"
                              id="purpose" name="purpose" data-bv-notempty="true"
                              data-bv-notempty-message="查定目的 不能为空"></textarea>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label">查定依据:</label>
                <div class="col-md-8">
                    <textarea placeholder="查定依据。"
                              class="layui-textarea form-control" lay-verify="required"
                              id="depand" name="depand" data-bv-notempty="true"
                              data-bv-notempty-message="查定依据 不能为空"></textarea>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label">查定内容:</label>
                <div class="col-md-8">
                    <textarea placeholder="查定内容。"
                              class="layui-textarea form-control" lay-verify="required"
                              id="details" name="details" data-bv-notempty="true"
                              data-bv-notempty-message="查定内容 不能为空"></textarea>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label">查定方法:</label>
                <div class="col-md-8">
                    <textarea placeholder="查定方法。"
                              class="layui-textarea form-control" lay-verify="required"
                              id="means" name="means" data-bv-notempty="true"
                              data-bv-notempty-message="查定方法 不能为空"></textarea>
                </div>
            </div>

            <di id="accessory_files"></di>

        </fieldset>
    </form>
</div>
<script src="../../js/constant.js"></script>
<script type="text/javascript" src="../../js/libs/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../../js/jq.js"></script>
<script type="text/javascript" src="../../js/chooseArea.js"></script>
<script type="text/javascript" src="../../js/plugin/bootstrapvalidator/bootstrapValidator.min.js"></script>
<script type="text/javascript" src="../../js/common.js"></script>
<script type="text/javascript" src="../../layui/layui.js"></script>
<script type="text/javascript" src='../list-layout/js/initSelectData.js'></script>



<script type="text/javascript">
    var layedit, index;

    var id = getUrlParam("id");
    var h = $(window).height() - 100;
    layui.use(['layedit','upload', 'laydate'], function(){
        layedit = layui.layedit;
        laydate = layui.laydate;
        index = layedit.build('demo',{tool:[], height:h});
    });
    initData();

    function initData(){
        var data = {
            id:id,
        }
        $.ajax({
            type : 'get',
            data:data,
            url : domainName + '/project-item/item/target/applyList',
            async : false,
            success : function(data) {
                $(data).each(function () {
                    $("#content").val(data[0].content);
                    $("#purpose").val(data[0].purpose);

                    $("#depand").val(data[0].depand);
                    $("#details").val(data[0].details);
                    $("#means").val(data[0].means);
                    $("#description").val(data[0].description);

                    $("#result").text(data[0].status == 3 ? "查定合格" : "查定不合格");

                    $("#period").text(formatDate3(data[0].start_date) + " - " + formatDate3(data[0].end_date));
                    $("#periods").val(formatDate3(data[0].start_date_true) + " - " + formatDate3(data[0].end_date_true));

                    $.get(domainName + "/project-item/item/indicators/ids", {ids: data[0].target_id}, function (data1) {
                        $.each(data1, function (i, item) {
                            var serial = $("#target").parents('thead').next().children().length + 1;
                            var str = '';
                            var text = getsuperior(item.site);
                            str = '<tr>' +
                                '<td class="mainTd_1 tdDorder">' + serial + '<input type="hidden" name="type" value="' + item.type + '"></td>' +
                                '<td class="mainTd_1 tdDorder" rowspan="1" colspan="1">' +
                                '<div class="field">' +
                                '<span type="text"  name="content" lay-verify="required"> ' + item.content + ' </span>' +
                                '</div>' +
                                '</td>' +
                                '<td class="mainTd_1 tdDorder" rowspan="1" colspan="1">' +
                                '<div class="field" style="position: relative;">' +
                                '<span type="text" name="site">' + text + '</span>' +
                                '</div>' +
                                '</td>' +
                                '</tr>';
                            $("#target").parents('thead').next().append(str);
                        });
                        $("input").attr('readonly', true);
                        $("input").attr("style", "text-align: center;border: 0px;");
                        $("textarea").attr('readonly', true);
                    })

                    $.get(domainName + "/api-f/albums/list", {ids: data[0].accessory}, function (data1) {
                        $.each(data1, function (i, item) {
                            addImgHtml(item)
                        });
                    })

                });

            }
        });
    }
    function addImgHtml(item) {
        var str = '';
        var val = item.name.substring(0, item.name.indexOf("."));
        if (val.length > 10) {
            val = val.substring(0, 8) + '...';
        }
        str = '<div style="float: left;position: relative;text-align: center;height: 250px;">';
        str += '<img onclick="seeImg(\'' + item.url + '\')" src="' + item.url + '" title="' + item.name + '" style="width: 150px;margin: 15px 5px 0 5px;">';
        str += '<p style="color: #aea9a9;">' + val + '</p></div>';
        $("#accessory_files").append(str);
    }
    var h = $(window).height() - 100;
    var w = $(window).width() - 200;
    function seeImg(url) {
        var imgHtml = "<img src='" + url + "'/>";
        layer.open({
            type: 1,
            maxmin: true,
            shadeClose: true,
            area: [w + 'px', h + 'px'],
            content: imgHtml, //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响
            cancel: function () {
                //layer.msg('捕获就是从
                // 页面已经存在的元素上，包裹layer的结构', { time: 5000, icon: 6 });
            }
        });
    }




</script>
</body>
</html>