<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" media="screen" href="../../../../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../../../layui/css/layui.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../css/details.css">
    <title>Title</title>
    <style>
        .layui-table thead tr {
            background: #dbe7f3;
            text-align: center;
        }
        .layui-table th {
            text-align: center;
            font-weight: 400;
        }
        .form-control {
            /*    width: 80%; */
        }
        .layui-btn {
            background-color: #a0a8c5;
        }
    </style>
</head>
<body>
<div class="module">
    <form class="layui-form" id="form2">
        <table lay-even lay-skin="nob" class="layui-table">
            <input type="hidden" value="" name="id" id="id"/>
            <colgroup>
                <col width="10%">
                <col width="90%">
            </colgroup>
            <thead>
            <th class="header" colspan="4">主要研究内容</th>
            </thead>
            <tbody>
            <tr>
                <td><input type="hidden" name="item_id" id="item_id"></td>
                <td>
                    <input class="form-control" lay-verify="required" placeholder="标题" type="text"
                           name="title" id="title">
                    <textarea placeholder="内容" class="layui-textarea form-control" lay-verify="required"
                              name="content" id="content"></textarea>
                </td>
            </tr>
            </tbody>
        </table>
        <!--提交按钮-->
        <div class="form-actions">
            <div class="row" align="center">
                <div class="col-md-12">
                    <button class="btn btn-primary" onclick="retuen_btn();">返回</button>
                    <button class="btn btn-primary" type="submit" onclick="save();">
                        <i class="fa fa-save"></i> 保存
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>
</body>
<script type="text/javascript" src="../../../../js/libs/jquery-3.3.1.min.js"></script>
<script src="../../../../js/constant.js"></script>
<script type="text/javascript" src="../../../../layui/layui.js"></script>
<script type="text/javascript" src="../../../../js/plugin/bootstrapvalidator/bootstrapValidator.min.js"></script>
<script type="text/javascript" src="../../../../js/jq.js"></script>
<script type="text/javascript" src="../../../../js/common.js"></script>
<script type="text/javascript" src='../../js/serializeJson.js'></script>
<script type="text/javascript" src="../../js/projecDetailst.js"> </script>
<script>
    var id = getUrlParam("id");
    var item_id;

    $("#id").val(id);

    layui.use(['layer', 'form', 'laydate', 'upload'], function () {
        var layer = layui.layer
            , upload = layui.upload
            , laydate = layui.laydate;
        lay('.date').each(function () {
            laydate.render({
                elem: this
                , showBottom: false
                , trigger: 'click'
            });
        });
        //监听提交
        form.on('submit(formDemo)', function (data) {
            layer.msg(JSON.stringify(data.field));
            return false;
        });
    });
    getcontent(id);
    function getcontent(id) {
        $.ajax({
            type: 'get',
            url: domainName + '/project-item/item/content/list',
            data: "id=" + id,
            async: false,
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var d=  data[0];
                item_id=d.item_id;
                $(data).each(function () {
                    $("#title").val(this.title);
                    $("#content").text(this.content);

                })
            }
        })
    }
    $("#item_id").val(item_id);
    function save() {
        var formdata = $("#form2").serializeObject();
        $.ajax({
            type: 'put',
            url: domainName + '/project-item/item/content/one',
            async: false,
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(formdata),
            success: function (data) {
                layer.msg("成功", {shift: -1, time: 3000}, function () {
                });
                var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
                parent.location.reload();//刷新父页面，注意一定要在关闭当前iframe层之前执行刷新
                parent.layer.close(index); //再执行关闭
            }
        });
    }
    function retuen_btn() {
        var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
        parent.location.reload();//刷新父页面，注意一定要在关闭当前iframe层之前执行刷新
        parent.layer.close(index); //再执行关闭
    }
</script>
</html>