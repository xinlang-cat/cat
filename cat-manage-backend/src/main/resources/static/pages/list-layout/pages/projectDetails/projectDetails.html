<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>项目信息</title>
    <link rel="stylesheet" type="text/css" media="screen" href="../../../../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../../../layui/css/layui.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/projectInfo.css">
    <style>
        .table-info {
            background-color: #4FAAA2;
            border-color: #4FAAA2;
            margin: 40px;
            color: white;
            font-size: 18px;
            font-weight: bolder;
            text-align: center;
        }

        .sub {
            display: none;
        }

        .layui-textarea {
            min-height: 50px;
            height: auto;
            line-height: 20px;
            padding: 6px 10px;
            resize: vertical;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>
<div class="content">
    <!--基本信息-->
    <div class="module">
        <div><h2 style="text-align: center;margin: 40px;">项目信息</h2></div>
        <form class="layui-form" id="form1">
            <div class="layui-btn-group btn-group" style="top: 68px;">
                <button type="button" class="layui-btn layui-btn-sm" style="border-radius: 2px;"
                        onclick="editData(this);">
                    <i class="layui-icon">&#xe642;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm hidden" onclick="saveData(this);">
                    <i class="layui-icon">&#xe605;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm hidden" onclick="cancelEdit(this);">
                    <i class="layui-icon">&#x1006;</i>
                </button>
            </div>
            <table class="layui-table">
                <colgroup>
                    <col width="3%">
                    <col width="10%">
                    <col width="37%">
                    <col width="10%">
                    <col width="40%">
                </colgroup>
                <thead>
                <tr>
                    <th class="table-info" style="border-bottom-color: #4FAAA2"></th>
                    <th colspan="4"><br></th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td rowspan="9" class="table-info">基本信息</td>
                    <td>合同编号：</td>
                    <td>
                        <input type="hidden" name="id" id="item_id">
                        <p id="contract_no_text"></p>
                        <input class="form-control hidden" lay-verify="required" placeholder="请输入合同编号" type="text"
                               id="contract_no" name="contract_no">
                    </td>
                    <td>计划类别：</td>
                    <td>
                        <p id="category_text"></p>
                        <select class="form-control input-sm hidden" lay-verify="required" lay-ignore id="category"
                                name="category">
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>项目名称：</td>
                    <td>
                        <p id="item_name_text"></p>
                        <input class="form-control hidden" lay-verify="required" placeholder="请输入项目名称" type="text"
                               id="item_name" name="item_name">
                    </td>
                    <td>委托单位：</td>
                    <td>
                        <p id="consignor_text"></p>
                        <select class="form-control input-sm hidden" lay-verify="required" lay-ignore id="consignor"
                                name="consignor">
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>承担单位：</td>
                    <td>
                        <p id="undertaker_text"></p>
                        <select class="form-control input-sm hidden" lay-verify="required" lay-ignore id="undertaker"
                                name="undertaker">
                        </select>
                    </td>
                    <td>管理单位：</td>
                    <td>
                        <p id="administrator_text"></p>
                        <select class="form-control input-sm hidden" lay-verify="required" lay-ignore id="administrator"
                                name="administrator">
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>开始时间：</td>
                    <td>
                        <p id="start_date_text"></p>
                        <input class="form-control date hidden" lay-verify="required" placeholder="开始时间" type="text"
                               id="start_date" name="start_date" readonly>
                    </td>
                    <td>结束时间：</td>
                    <td>
                        <p id="end_date_text"></p>
                        <input class="form-control date hidden" lay-verify="required" placeholder="结束时间" type="text"
                               id="end_date" name="end_date" readonly>
                    </td>
                </tr>
                <tr>
                    <td>下达文号：</td>
                    <td>
                        <p id="item_number_text"></p>
                        <input class="form-control hidden" lay-verify="required" placeholder="请输入下达文号" type="text"
                               id="item_number" name="item_number">
                    </td>
                    <td>合同文件：</td>
                    <td>
                        <!--<p id="contract_file_text"></p>-->
                        <a id="contract_file_text" href=""></a>
                        <input class="form-control hidden" placeholder="合同文件" type="text" id="contract_file"
                               name="contract_file"
                               readonly>
                    </td>
                </tr>
                </tbody>
            </table>
            <table class="layui-table">
                <colgroup>
                    <col width="3%">
                    <col width="10%">
                    <col width="87%">
                </colgroup>
                <thead>
                </thead>
                <tbody>
                <tr>
                    <td rowspan="2" class="table-info">总体目标</td>
                    <td>总体目标</td>
                    <td>
                        <p id="outline_text"></p>
                        <textarea placeholder="总体目标" class="layui-textarea form-control hidden" lay-verify="required"
                                  id="outline" name="outline"></textarea>
                    </td>
                </tr>
                </tbody>
            </table>
            <!--提交按钮-->
            <button class="layui-btn sub" lay-submit lay-filter="sub1" id="sub1">提交</button>
        </form>
    </div>
    <!--主要研究内容-->
    <div class="module">
        <form class="layui-form" id="form2">
            <div class="layui-btn-group btn-group">
                <button type="button" class="layui-btn layui-btn-sm" style="border-radius: 2px;"
                        onclick="editData(this);">
                    <i class="layui-icon">&#xe642;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm hidden"
                        onclick="add_row(this,'RESEARCH_CONTENTS');">
                    <i class="layui-icon">&#xe654;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm hidden" onclick="del_row(this);">
                    <i class="layui-icon">&#xe640;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm hidden" onclick="saveData(this);">
                    <i class="layui-icon">&#xe605;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm hidden" onclick="cancelEdit(this);">
                    <i class="layui-icon">&#x1006;</i>
                </button>
            </div>
            <table class="layui-table">
                <colgroup>
                    <col width="3%">
                    <col width="10%">
                    <col width="87%">
                </colgroup>
                <thead>
                <tr>
                    <th class="table-info" style="border-bottom-color: #4FAAA2"></th>
                    <th>序号</th>
                    <th>标题和内容</th>
                </tr>
                </thead>
                <tbody id="mian-content">
                <tr>
                    <td rowspan="1" class="table-info">主要研究内容</td>

                </tr>
                </tbody>
            </table>
            <!--提交按钮-->
            <button class="layui-btn sub" lay-submit lay-filter="sub2" id="sub2">提交</button>
        </form>
    </div>
    <!--项目成员-->
    <div class="module">
        <form class="layui-form" id="form4">
            <div class="layui-btn-group btn-group">
                <button type="button" class="layui-btn layui-btn-sm" style="border-radius: 2px;"
                        onclick="editData(this);">
                    <i class="layui-icon">&#xe642;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm hidden" onclick="add_row(this,'PROJECT_TEAM');">
                    <i class="layui-icon">&#xe654;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm hidden" onclick="del_row(this);">
                    <i class="layui-icon">&#xe640;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm hidden" onclick="saveData(this);">
                    <i class="layui-icon">&#xe605;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm hidden" onclick="cancelEdit(this);">
                    <i class="layui-icon">&#x1006;</i>
                </button>
            </div>
            <table class="layui-table">
                <colgroup>
                    <col width="3%">
                    <col width="10%">
                    <col width="7%">
                    <col width="7%">
                    <col width="20%">
                    <col width="10%">
                    <col width="10%">
                    <col width="17%">
                    <col width="20%">
                </colgroup>
                <thead>
                <tr>
                    <th class="table-info" style="border-bottom-color: #4FAAA2"></th>
                    <th colspan="8"><br></th>
                </tr>
                <tr>
                    <th class="table-info" style="border-bottom-color: #4FAAA2"></th>
                    <th>姓名</th>
                    <th>性别</th>
                    <th>年龄</th>
                    <th>证件类型/证件号码</th>
                    <th>职称</th>
                    <th>从事专业</th>
                    <th>工作单位</th>
                    <th>手机号码</th>
                </tr>
                </thead>
                <tbody id="PERSONNEL">

                </tbody>
            </table>
            <!--提交按钮-->
            <button class="layui-btn sub" lay-submit lay-filter="sub4" id="sub4">提交</button>
        </form>
    </div>
    <!--考核指标-->
    <div class="module">
        <form class="layui-form" id="form3">
            <div class="layui-btn-group btn-group">
                <button type="button" class="layui-btn layui-btn-sm" style="border-radius: 2px;"
                        onclick="editData(this);">
                    <i class="layui-icon">&#xe642;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm hidden" onclick="addTarget();">
                    <i class="layui-icon">&#xe654;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm hidden" onclick="deleteTarget();">
                    <i class="layui-icon">&#xe640;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm hidden" onclick="saveData(this);">
                    <i class="layui-icon">&#xe605;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm hidden" onclick="cancelEdit(this);">
                    <i class="layui-icon">&#x1006;</i>
                </button>
            </div>
            <table class="layui-table">
                <colgroup>
                    <col width="3%">
                    <col width="10%">
                    <col width="20%">
                    <col width="7%">
                    <col width="12%">
                    <col width="12%">
                    <col width="26%">
                    <col width="10%">
                </colgroup>
                <thead>
               <tr>
                    <th class="table-info" style="border-bottom-color: #4FAAA2"></th>
                    <th colspan="7"><br></th>
                </tr>
               <tr>
                   <th class="table-info" style="border-bottom-color: #4FAAA2"></th>
                   <th>类型</th>
                   <th colspan="2">内容</th>
                   <!--<th>数量</th>-->
                   <th>开始时间</th>
                   <th>结束时间</th>
                   <th>地点</th>
                   <th>实施人员</th>
               </tr>
                </thead>
                <tbody id="INDICATORS">
                <tr>
                    <td rowspan="1" class="table-info">考核指标</td>
                </tr>
                </tbody>
            </table>
            <!--提交按钮-->
            <button class="layui-btn sub" lay-submit lay-filter="sub3" id="sub3">提交</button>
        </form>
    </div>
    <!--科技经费用途预算-->
    <div class="module">
        <form class="layui-form" id="form5">
            <div class="layui-btn-group btn-group">
                <button type="button" class="layui-btn layui-btn-sm" style="border-radius: 2px;"
                        onclick="editData(this);">
                    <i class="layui-icon">&#xe642;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm hidden" onclick="addFund();">
                    <i class="layui-icon">&#xe654;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm hidden" onclick="deleteFund();">
                    <i class="layui-icon">&#xe640;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm hidden" onclick="saveData(this);">
                    <i class="layui-icon">&#xe605;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm hidden" onclick="cancelEdit(this);">
                    <i class="layui-icon">&#x1006;</i>
                </button>
            </div>
            <table class="layui-table" id="basis">
                <colgroup>
                    <col width="3%">
                    <col width="10%">
                    <col width="20%">
                    <col width="10%">
                    <col width="20%">
                    <col width="37%">
                </colgroup>
                <thead>
                <tr>
                    <th class="table-info" style="border-bottom-color: #4FAAA2"></th>
                    <th colspan="5"><br></th>
                </tr>
                <tr>
                    <th class="table-info" style="border-bottom-color: #4FAAA2"></th>
                    <th>费用</th>
                    <th>科目</th>
                    <th>金额（万元）</th>
                    <th>经费来源</th>
                    <th>开支内容</th>
                </tr>
                </thead>
                <tbody id="EXPENDITURE">
                <tr>
                    <td rowspan="8" class="table-info" id="thead">经费用途预算</td>
                    <td>合计</td>
                    <td></td>
                    <td id="total"></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td colspan="5"></td>
                </tr>

                <tr id="interval">
                    <td colspan="5"></td>
                </tr>

                </tbody>
            </table>
            <!--提交按钮-->
            <button class="layui-btn sub" lay-submit lay-filter="sub5" id="sub5">提交</button>
        </form>
    </div>
    <!--签订合同各方-->
    <div class="module">
        <form class="layui-form" id="form6">
            <div class="layui-btn-group btn-group">
                <button type="button" class="layui-btn layui-btn-sm" style="border-radius: 2px;"
                        onclick="editData(this);">
                    <i class="layui-icon">&#xe642;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm hidden" onclick="saveData(this);">
                    <i class="layui-icon">&#xe605;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm hidden" onclick="cancelEdit(this);">
                    <i class="layui-icon">&#x1006;</i>
                </button>
            </div>
            <table class="layui-table">
                <colgroup>
                    <col width="3%">
                    <col width="10%">
                    <col width="15%">
                    <col width="27%">
                    <col width="15%">
                    <col width="30%">
                </colgroup>
                <thead>
                <tr>
                    <th class="table-info" style="border-bottom-color: #4FAAA2"></th>
                    <th colspan="5"><br></th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td rowspan="9" class="table-info">签订合同各方联系方式</td>
                    <td rowspan="3">甲方<input type="hidden" name="item_id"><input type="hidden" name="type" value="0">
                    </td>
                    <td>联系人</td>
                    <td>
                        <p id="linkman_0"></p>
                        <input class="form-control hidden" placeholder="联系人" type="text"
                               name="linkman" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="联系人 不能为空"></td>
                    <td>电话</td>
                    <td>
                        <p id="phone_0"></p>
                        <input class="form-control hidden" placeholder="电话" type="text"
                               name="phone" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="电话 不能为空"></td>
                </tr>
                <tr>
                    <td>传真</td>
                    <td>
                        <p id="fax_0"></p>
                        <input class="form-control hidden" placeholder="传真"
                               type="text" name="fax" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="传真 不能为空"></td>
                    <td>邮编</td>
                    <td>
                        <p id="postal_code_0"></p>
                        <input class="form-control hidden" placeholder="邮编" type="text"
                               name="postal_code" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="邮编 不能为空"></td>
                </tr>
                <tr>
                    <td>地址</td>
                    <td>
                        <p id="site_0"></p>
                        <input class="form-control hidden" placeholder="地址" type="text"
                               name="site" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="地址 不能为空"></td>
                    <td>E-mail(电子邮箱)</td>
                    <td>
                        <p id="email_0"></p>
                        <input class="form-control hidden" placeholder="E-mail(电子邮箱)" type="text"
                               name="email" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="E-mail(电子邮箱) 不能为空"></td>
                </tr>
                <tr>
                    <td rowspan="3">乙方<input type="hidden" name="item_id"><input type="hidden" name="type" value="1">
                    </td>
                    <td>联系人</td>
                    <td>
                        <p id="linkman_1"></p>
                        <input class="form-control hidden" placeholder="联系人" type="text"
                               name="linkman" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="联系人 不能为空"></td>
                    <td>电话</td>
                    <td>
                        <p id="phone_1"></p>
                        <input class="form-control hidden" placeholder="电话" type="text"
                               name="phone" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="电话 不能为空"></td>
                </tr>
                <tr>
                    <td>传真</td>
                    <td>
                        <p id="fax_1"></p>
                        <input class="form-control hidden" placeholder="传真"
                               type="text" name="fax" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="传真 不能为空"></td>
                    <td>邮编</td>
                    <td>
                        <p id="postal_code_1"></p>
                        <input class="form-control hidden" placeholder="邮编" type="text"
                               name="postal_code" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="邮编 不能为空"></td>
                </tr>
                <tr>
                    <td>地址</td>
                    <td>
                        <p id="site_1"></p>
                        <input class="form-control hidden" placeholder="地址" type="text"
                               name="site" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="地址 不能为空"></td>
                    <td>E-mail(电子邮箱)</td>
                    <td>
                        <p id="email_1"></p>
                        <input class="form-control hidden" placeholder="E-mail(电子邮箱)" type="text"
                               name="email" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="E-mail(电子邮箱) 不能为空"></td>
                </tr>
                <tr>
                    <td rowspan="3">丙方<input type="hidden" name="item_id"><input type="hidden" name="type" value="2">
                    </td>
                    <td>联系人</td>
                    <td>
                        <p id="linkman_2"></p>
                        <input class="form-control hidden" placeholder="联系人" type="text"
                               name="linkman" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="联系人 不能为空"></td>
                    <td>电话</td>
                    <td>
                        <p id="phone_2"></p>
                        <input class="form-control hidden" placeholder="电话" type="text"
                               name="phone" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="电话 不能为空"></td>
                </tr>
                <tr>
                    <td>传真</td>
                    <td>
                        <p id="fax_2"></p>
                        <input class="form-control hidden" placeholder="传真"
                               type="text" name="fax" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="传真 不能为空"></td>
                    <td>邮编</td>
                    <td>
                        <p id="postal_code_2"></p>
                        <input class="form-control hidden" placeholder="邮编" type="text"
                               name="postal_code" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="邮编 不能为空"></td>
                </tr>
                <tr>
                    <td>地址</td>
                    <td>
                        <p id="site_2"></p>
                        <input class="form-control hidden" placeholder="地址" type="text"
                               name="site" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="地址 不能为空"></td>
                    <td>E-mail(电子邮箱)</td>
                    <td>
                        <p id="email_2"></p>
                        <input class="form-control hidden" placeholder="E-mail(电子邮箱)" type="text"
                               name="email" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="E-mail(电子邮箱) 不能为空"></td>
                </tr>
                </tbody>
            </table>
            <button class="layui-btn sub" lay-submit lay-filter="sub6" id="sub6">提交</button>
        </form>
        <div class="form-actions" style="margin: 40px auto;">
            <div class="row" align="center">
                <div class="col-md-12">
                    <button class="btn btn-primary" onclick=" history.back(-1);">返回</button>
                    <!--<button class="btn btn-primary" type="submit" onclick="save();">
                        <i class="fa fa-save"></i> 保存
                    </button>-->
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script type="text/javascript" src='../../../../js/constant.js'></script>
<script type="text/javascript" src="../../../../js/libs/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../../../../js/jq.js"></script>
<script type="text/javascript" src="../../../../layui/layui.js"></script>
<script type="text/javascript" src='../../../../js/common.js'></script>
<script type="text/javascript" src='../../js/serializeJson.js'></script>
<script type="text/javascript" src='../../js/initSelectData.js'></script>
<script type="text/javascript" src='../../js/saveData.js'></script>
<script type="text/javascript" src='../../js/updateTable.js'></script>
<script type="text/javascript" src="../../js/projecDetailst.js"></script>
<script type="text/javascript" src='../../js/updateProject.js'></script>
<script>
    layui.use(['layer', 'form', 'laydate', 'upload'], function () {
        var layer = layui.layer
            , upload = layui.upload
            , form = layui.form
            , laydate = layui.laydate;
        lay('.date').each(function () {
            laydate.render({
                elem: this
                , showBottom: false
                , trigger: 'click'
            });
        });
        //监听提交
        form.on('submit(sub1)', function (data) {
            updateBasics();
            return false;
        });
        form.on('submit(sub2)', function (data) {
            updateContent();
            return false;
        });
        form.on('submit(sub3)', function (data) {
            updateTarget()
            return false;
        });
        form.on('submit(sub4)', function (data) {
            updatePersonnel();
            return false;
        });
        form.on('submit(sub5)', function (data) {
            updateFund();
            return false;
        });
        form.on('submit(sub6)', function (data) {
            updateContacts();
            return false;
        });
    });

    //编辑
    function editData(e) {
        $(e).parent().parent().find('.hidden').removeClass('hidden');
        $(e).parent().parent().find('p').addClass('hidden');
        $(e).addClass('hidden');
    }

    //保存
    function saveData(e) {
        $(e).parent().parent().children('button').trigger('click');
    }

    //取消
    function cancelEdit(e) {
        window.location.reload();
        /*$(e).parent().parent().find('.hidden').removeClass('hidden');
        $(e).parent().parent().find('input').addClass('hidden');
        $(e).parent().parent().find('select').addClass('hidden');
        $(e).parent().parent().find('textarea').addClass('hidden');
        $(e).parent().children().first().nextAll().addClass('hidden');*/
    }

    /*初始化select数据*/
    initSelectData('PLAN_CATEGOR', $('#category'));//计划类别
    initSelectData('INDICATORS_OF_LIBRARY', $('select[name=target]'));//考核指标
    initCompanySelect();
    initProvinceSelect();
    queryDeptCode();
    initUserSelect(deptCode, $('select[name=user_id]'));
    initSelectData('BUDGET_SUBJECT', $('select[name=subject]'));
    initSelectData('FUNDING_SOURCE', $('select[name=source]'));

    //获取项目数据项目
    var id = getUrlParam("id");
    $('#item_id').val(id);
    $("input[name='item_id']").val(id);
    getBasic(id);
    getContent(id);
    getTarget(id);
    getItemUser(id);
    getFund(id);
    getContacts(id);

    //监听地点选择
    $(".content").on('change', '.site', function () {
        var code = $(this).val();
        var text = $(this).next().text() + $(this).find("option:selected").text() + '-';
        $(this).next().val(code);
        $(this).next().text(text);
        $(this).empty();
        $(this).append("<option value='" + code + "'>" + text + "</option>");
        var texts = text.split('-');
        if (texts.length == 2) {
            getCity(code, $(this));
        } else if (texts.length == 3) {
            getArea(code, $(this));
        } else if (texts.length == 4) {
            getStreet(code, $(this));
        }
    });

    //刷新地点选择
    function refresh(e) {
        var siteSelect = $(e).prev().prev();
        siteSelect.empty();
        siteSelect.append("<option value=''>请选择</option>");
        getProvince(siteSelect);
        siteSelect.next().val('');
        siteSelect.next().text('');
    }

    //监听人员选择
    $(".content").on('change', 'select[name=user_id]', function () {
        var usetId = $(this).val();
        queryUserInfo(usetId, $(this));
    });
    //监听负责分工
    $(".content").on('click', '.targetIds', function () {
        var thisInput = $(this);
        layui.use(['form', 'layer'], function () {
            var form = layui.form;
            var layer = layui.layer;

            index = layer.open({
                title: "负责或参与的指标",
                type: 1,
                area: ['800px', '400px'],
                btn: ['确定', '关闭'],
                yes: function (index, layero) {
                    var titles = [], vals = [];
                    $('input[name=fake]:checked').each(function () {
                        titles.push($(this).attr('title'));
                        vals.push($(this).val());
                    })
                    thisInput.val(titles);
                    thisInput.next().val(vals);
                    layer.close(index);
                },
                btn2: function (index, layero) {
                    layer.close(index);
                },
                content: '<div class="layui-form"><div class="layui-form-item">\n' +
                    '    <label class="layui-form-label">请选择</label>\n' +
                    '    <div class="layui-input-block checkbox">\n' +
                    '    </div>\n' +
                    '  </div></div>'
            });
            $("select[name=target]").each(function () {
                var val = $(this).find('option:selected').val();
                var text = $(this).find('option:selected').text();
                if (val != '') {
                    $(".checkbox").append('<input type="checkbox" name="fake" value="' + val + '" title="' + text + '">');
                }
            })
            form.render('checkbox');
        })
    });
    //定时任务,监听预算的合计
    var ref = setInterval(function () {
        var total = 0;
        $('input[name=money]').each(function () {
            total += $(this).val() - 0;
        })
        $('#total').text(total);
    }, 1000);

</script>

</html>