<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <link rel="stylesheet" type="text/css" media="screen" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../layui/css/layui.css">

    <style>
        .title {
            text-align: center;
            line-height: 30px;
            color: black;
            font-weight: 600;
            background-color: #e4e4e4;
            height: 30px;
        }

        .table {
            margin: 0;
        }

        p {
            word-wrap: break-word;
            word-break: break-all;
        }
    </style>
</head>
<body>


<div style="position: absolute;width: 80px;margin-top: 60px;" >
    <button  id="New"  style="width:80px;margin-left: 10px;" type="button" class="layui-btn layui-btn-primary">新&nbsp;&nbsp;建</button>
    <button id="Pass" style="width: 80px;" type="button" class="layui-btn layui-btn-primary">通&nbsp;&nbsp;过</button>
    <button  id="No"  style="width: 80px;" type="button" class="layui-btn layui-btn-primary">不通过</button>
    <button onclick="history.back(-1);" style="width: 80px;" type="button" class="layui-btn layui-btn-primary">返回</button>
</div>

<div style="margin-top: 10px;" class="layui-row">
    <div class="layui-col-xs10 layui-col-sm10 layui-col-md10 layui-col-lg10
layui-col-xs-offset1 layui-col-sm-offset1 layui-col-md-offset1 layui-col-lg-offset1">
        <p class="title">使用资金</p>

        <table class="table table-striped table-bordered table-hover">
            <colgroup>
                <col width="80">
                <col width="50">
                <col width="150">
                <col width="50">
                <col width="100">
                <col width="80">
            </colgroup>
            <thead>
            <tr>
                <th style="text-align: center;">科目</th>
                <th style="text-align: center;">金额(万元)</th>
                <th style="text-align: center;">开支内容</th>
                <th style="text-align: center;">证明材料</th>
                <th style="text-align: center;">意见</th>
                <th style="text-align: center;">操作</th>
            </tr>
            <tr>
                <th style="text-align: center;" >合计</th>
                <th  ><p style="text-align: center;" id="res_money"></p></th>
                <th ></th>
                <th ></th>
                <th ></th>
                <th ></th>

            </tr>


            </thead>
            <tbody id="report_content" >
            </tbody>
        </table>
    </div>
</div>

</body>


<script src="../../js/constant.js"></script>
<script type="text/javascript" src="../../js/libs/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../../js/jq.js"></script>
<script type="text/javascript" src="../../js/plugin/bootstrapvalidator/bootstrapValidator.min.js"></script>
<script type="text/javascript" src="../../js/common.js"></script>
<script type="text/javascript" src="../../layui/layui.js"></script>

<script type="text/javascript" src="../../js/project/initData.js"></script>
<script type="text/javascript" src="../../js/project/projectDetails.js"></script>



<script>
    var id = getUrlParam("id");

    $("#New").click(function () {
        $(location).attr("href", "new_usefund.html?id=" + id + "");
    })
    $("#No").click(function () {
        $(location).attr("href", "No_usefund.html?id=" + id + "");
    })
    $("#Pass").click(function () {
        $(location).attr("href", "UseOfFunding.html?id=" + id + "");
    })

    layui.use(['layer'], function () {
        var layer = layui.layer;
    });


    $("#add_UseFund").click(function () {
        $(location).attr("href", "add_UseFund.html?id=" + id + "");
    })
    var money=0;
    var subjectName;
    $(function(){
        $.ajax({
            type: 'get',
            url: domainName + '/project-item/item/fund/use/my/'+id,
            async:false,
            contentType: "application/json; charset=utf-8",
            success: function (res) {
                res.status=0
                var str = '';
                $(res).each(function () {
                    if(this.status==2) {
                        money += this.expenditure;
                        getbudegetname(this.budget_id);
                        str += '<tr>'
                            + '<th style="text-align: center;">' + subjectName + '</th>'
                            + '<th style="text-align: center;">' + this.expenditure + '</th>'
                            + '<th style="text-align: center;">' + this.remark + ' </th>'
                            + '<th  style="text-align: center;"><a href="userfundimg.html?id=' + this.id + '">详情</a></th>'
                            +'<th style="text-align: center;"> '+this.check_opinion+' </th>'
                            + '<th style="text-align: center;">'
                            + ' <div style="width: 100%;height: 20px;align-self: center;">'
                            + '<button onclick="update_useFund(' + this.id + ')" style="height: 20px;width: 30px;" class="layui-btn layui-btn-sm">'
                            + '<p style="line-height: 20px;margin-left: -3px;"><i class="layui-icon">&#xe642;</i></p>'
                            + '</button>'
                            + '<button onclick="delete_userFund(' + this.id + ');" style="height: 20px;width: 30px;align-self: center;"   class="layui-btn layui-btn-sm">  <p style="line-height: 20px;margin-left: -3px;"><i  class="layui-icon">&#xe640;</i></p>'
                            + '</button>'
                            + '<button onclick="check_userFund(' + this.id + ');" style="height: 20px;width: 30px;align-self: center;"   class="layui-btn layui-btn-sm">  <p style="line-height: 20px;margin-left: -3px;"><i  class="layui-icon">&#xe605;</i></p>'
                            + '</button>'
                            + '</div>'
                            + '</th>';
                    }
                })
                $("#res_money").text(money);
                $("#report_content").append(str);
            }
        })
    })
    function getbudegetname(bid){

        $.ajax({
            type: 'get',
            url: domainName + '/project-item/item/budget/' + bid,
            async:false,
            contentType: "application/json; charset=utf-8",
            success: function (res) {
                subjectName=res.subject;
            }
        })
    }

    function update_useFund(id){
        $(location).attr("href", "updata_UserFund.html?id=" + id + "");
    }

    function delete_userFund(uid){
        layer.confirm('确定要删除吗？', {
            btn: ['确定', '取消']
        }, function () {
            $.ajax({
                type: 'delete',
                url: domainName + '/project-item/item/fund/use/'+uid,
                success: function (data) {
                    window.location.reload();
                    layer.msg("删除成功");
                }
            });
            layer.close(1);
        });
    }





    function check_userFund(id){
        $(location).attr("href", "check_usefund.html?id=" + id + "");
    }

</script>
</html>