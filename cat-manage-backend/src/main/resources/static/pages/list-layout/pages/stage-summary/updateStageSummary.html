<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>修改阶段报告</title>
    <link rel="stylesheet" type="text/css" media="screen" href="../../../../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../../../layui/css/layui.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/projectInfo.css">
    <style>
        .layui-table thead tr {
            text-align: center;
        }

        .layui-table th {
            text-align: center;
            font-weight: 400;
        }

        tbody td {
            text-align: left;
            border: 1px solid #000;
        }

        span {
            float: left;
        }

        .table-info {
            background-color: #4FAAA2;
            margin: 40px;
            color: white;
            font-size: 18px;
            font-weight: bolder;
        }

        .td-text {
            font-size: 14px;
            font-weight: bolder;
        }

        .td-text1 {
            text-align: right;
            font-size: 14px;
            font-weight: bolder;
        }

        .layui-input-block {
            margin-left: 0px;
        }

        .layui-form-radio {
            width: 220px;
        }
        .layui-form-radio {
            margin: 0;
        }

        .layui-form-label {
            width: 120px;
            font-weight: bold;
            text-align: left;
            padding: 0;
            margin-bottom: 0;
            margin-top: 5px;
        }

        .layui-input-block {
            min-height: auto;
        }

        .layui-form-item {
            margin-bottom: 0;
        }
        .layui-disabled > div{
            color: #666;
        }
    </style>
</head>

<body>
<div class="content" style="margin-bottom: 100px;">

    <div><h1 style="text-align: center;margin-top: 40px;margin-bottom: 20px;">执行报告</h1></div>
    <div style="text-align: center;margin-bottom: 20px;"><h3>（科技重大专项、重点研发计划、技术创新引导专项、基地与人才专项类别适用）</h3></div>
    <div style="margin:40px;">
        <h2>填报说明:</h2>
        <span style="margin-left: 40px;">
                一、制表目的：本套调查表是为掌握广西科技计划项目的执行情况，加强科技计划项目的管理，促进科技计 划管理的规范化、科学化而设计。</br>
            二、调查范围：报告期内仍在实施的广西科技计划项目(课题)。调查表由项目（课题）负责人填报，项目（ 课题）第一承担单位审核。</br>
            三、报告期： 2018年01月01日 至 2019年12月31日</br>
            四、填报要求：</br>
            1.调查表上报时，必须由项目负责人签章确认并盖填表单位公章。</br>
            2.要按调查表所规定的指标含义、计算方法、分类标准、编号代码等认真填报。未经同意，任何单位和个人 不得修改，不得虚报、瞒报、谎报数据。</br>
            五、关于填报内容的说明</br>
            1．项目的经费管理情况，指的是项目所有经费的情况（不仅指科技厅资助的经费）。</br>
            2. 项目效益及成果情况，有则填，无则不填。</br>
            </span>
    </div>

    <form class="layui-form" onsubmit="return false" id="form">
        <div class="module">
            <table class="layui-table">
                <colgroup>
                    <col width="3%">
                    <col width="15%">
                    <col width="34%">
                    <col width="14%">
                    <col width="34%">
                </colgroup>
                <tbody>
                <tr>
                    <td rowspan="4" class="table-info">基本信息</td>
                    <td class="td-text1">项目名称:</td>
                    <td>
                        <span class="itemName"></span>
                    </td>
                    <td class="td-text1">合同编号:</td>
                    <td>
                        <span class="contractNo"></span>
                    </td>
                </tr>
                <tr>
                    <td class="td-text1">项目类别:</td>
                    <td>
                        <span class="category"></span>
                    </td>
                    <td class="td-text1">承担单位:</td>
                    <td>
                        <span class="undertaker"></span>
                    </td>
                </tr>
                <tr>
                    <td class="td-text1">填 报 人:</td>
                    <td>
                        <span class="createUserName"></span>
                    </td>
                    <td class="td-text1">填报人电话:</td>
                    <td>
                        <span class="createUserPhone"></span>
                    </td>
                </tr>
                <tr>
                    <td class="td-text1">填报人邮箱:</td>
                    <td>
                        <span class="createUserEmail"></span>
                    </td>
                    <td class="td-text1">填报日期:</td>
                    <td>
                        <span class="createTime"></span>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="module">
            <table class="layui-table">
                <colgroup>
                    <col width="3%">
                    <col width="15%">
                    <col width="38%">
                    <col width="16%">
                    <col width="28%">
                </colgroup>
                <tbody>
                <tr>
                    <td rowspan="100" class="table-info">项目基本信息及执行进展情况</td>
                    <td class="td-text1">合同规定起止时间:</td>
                    <td colspan="3" style="text-align: center">
                        <span class="startAndEndTime"></span>
                    </td>
                </tr>
                <tr>
                    <td class="td-text1">是否申请延期:</td>
                    <td>
                        <input type="radio" name="applicantExtension" value="是" title="是">
                        <input type="radio" name="applicantExtension" value="否" title="否">
                    </td>
                    <td class="td-text1">延期批复的截至时间</td>
                    <td>
                        <span> <input class="form-control date" placeholder="申请日期" type="text"
                                      name="extensionTime" maxlength="50"
                                      id="extensionTime" data-bv-notempty="true"
                                      data-bv-notempty-message="申请日期 不能为空"></span>
                    </td>
                </tr>
                <tr>
                    <td class="td-text1">产学研联合:</td>
                    <td colspan="3">
                        <input type="radio" name="produceLearnResearch" value="是" title="是">
                        <input type="radio" name="produceLearnResearch" value="否" title="否">
                    </td>
                </tr>
                <tr>
                    <td class="td-text1">创新类型:</td>
                    <td colspan="3">
                        <input type="radio" name="innovateType" value="原始创新" title="原始创新">
                        <input type="radio" name="innovateType" value="集成创新" title="集成创新">
                        <input type="radio" name="innovateType" value="引进消化吸收再创新" title="引进消化吸收再创新">
                    </td>
                </tr>
                <tr>
                    <td class="td-text1">合作形式:</td>
                    <td colspan="3">
                        <input type="radio" name="collaborate" value="国外（境外）合作" title="国外（境外）合作">
                        <input type="radio" name="collaborate" value="区外合作" title="区外合作">
                        <input type="radio" name="collaborate" value="区内合作" title="区内合作">
                        <input type="radio" name="collaborate" value="自主研发" title="自主研发">
                    </td>
                </tr>
                <tr>
                    <td class="td-text1">主要技术来源单位:</td>
                    <td colspan="3">
                        <input type="radio" name="skillSourceDept" value="区外科研院所" title="区外科研院所">
                        <input type="radio" name="skillSourceDept" value="区外大专院校" title="区外大专院校">
                        <input type="radio" name="skillSourceDept" value="区外企业及其所属科技机构" title="区外企业及其所属科技机构">
                        <input type="radio" name="skillSourceDept" value="区内科研院所" title="区内科研院所">
                        <input type="radio" name="skillSourceDept" value="区内大专院校" title="区内大专院校">
                        <input type="radio" name="skillSourceDept" value="区内企业及其所属科技机构" title="区内企业及其所属科技机构">
                        <input type="radio" name="skillSourceDept" value="国外（境外）" title="国外（境外）">
                        <input type="radio" name="skillSourceDept" value="自有技术" title="自有技术">
                        <input type="radio" name="skillSourceDept" value="其它" title="其它">
                    </td>
                </tr>
                <tr>
                    <td class="td-text1">项目进展情况:</td>
                    <td colspan="3">
                        <input type="radio" name="progress" value="按计划进度进行" title="按计划进度进行">
                        <input type="radio" name="progress" value="进度超前" title="进度超前">
                        <input type="radio" name="progress" value="拖延" title="拖延">
                        <input type="radio" name="progress" value="停顿" title="停顿">
                        <input type="radio" name="progress" value="申请终止" title="申请终止">
                        <input type="radio" name="progress" value="撤销" title="撤销">
                        <input type="radio" name="progress" value="已完成(未验收)" title="已完成(未验收)">
                        <input type="radio" name="progress" value="已验收" title="已验收">
                    </td>
                </tr>
                <tr>
                    <td class="td-text1">项目拖延、停顿、终止 、撤销的主要原因（最 多选三项）:</td>
                    <td>
                        <div class="layui-input-block"><input type="checkbox" lay-skin="primary" name="causes" value="0"
                                                              title="0.技术变化"></div>
                        <div class="layui-input-block"><input type="checkbox" lay-skin="primary" name="causes" value="1"
                                                              title="1.计划性调整"></div>
                        <div class="layui-input-block"><input type="checkbox" lay-skin="primary" name="causes" value="2"
                                                              title="2.设备、材料不落实"></div>
                        <div class="layui-input-block"><input type="checkbox" lay-skin="primary" name="causes" value="3"
                                                              title="3.协作关系影响"></div>
                        <div class="layui-input-block"><input type="checkbox" lay-skin="primary" name="causes" value="4"
                                                              title="4.资金不到位"></div>
                        <div class="layui-input-block"><input type="checkbox" lay-skin="primary" name="causes" value="5"
                                                              title="5.市场变化"></div>
                        <div class="layui-input-block"><input type="checkbox" lay-skin="primary" name="causes" value="6"
                                                              title="6.技术骨干变动"></div>
                        <div class="layui-input-block"><input type="checkbox" lay-skin="primary" name="causes" value="7"
                                                              title="7.立题不当"></div>
                        <div class="layui-input-block"><input type="checkbox" lay-skin="primary" name="causes" value="8"
                                                              title="8.不可抗拒因素"></div>
                        <div class="layui-input-block"><input type="checkbox" lay-skin="primary" name="causes" value="9"
                                                              title="9.合作方变动"></div>
                        <div class="layui-input-block"><input type="checkbox" lay-skin="primary" name="causes" value="10"
                                                              title="10.其他原因"></div>
                    </td>
                    <td colspan="2">
                        <span>
                            勾选项目进展受阻的主要原因，最多选三项：</br>    
                            0.技术变化：由于国内外技术取得进展及技术发展趋势发 生变化而导致该项目计划进度等变化。</br>    
                            1.计划性调整：由项目组织部门或主管部门审定对合同书 的计划进度进行的调整。</br>  
                            2.设备、材料不落实：由于设备紧张、材料短缺等原因而 影响计划进度的完成。</br>     
                            3.协作关系影响：由于协作单位拖延加工、检验、测试以 及依托工程拖延等影响计划进度的完成。</br>     
                            4.资金不到位：由于在报告期内项目资金不到位而影响计 划进度的完成。</br>     
                            5.市场变化：由于市场的供求状况发生改变，而使该项目 不能或不宜按原计划进度进行。</br>     
                            6.技术骨干变动：由于项目组技术骨干调动或较长时间脱 离项目活动等原因而影响计划进度完成。</br>     
                            7.立题不当：由于可行性研究不够、制定的指标过高、技 术不成熟、技术力量不足，导致项目难以进行而影响计划进度 的完成。</br>     
                            8.不可抗拒因素：人力不可抗拒因素，例如自然灾害等。</br>     
                            9.合作方变动：国际或区域科技合作项目的合作方发生变 动，导致项目难以按计划完成。</br>     
                            10.其他原因：除上述原因以外，影响计划进度完成的其 他各种原因。论文发表周期较长、项目建设场地问题。</br>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4"></td>
                </tr>
                <tr>
                    <td colspan="4" style="text-align: center;"><h3>考核指标完成情况</h3></td>
                </tr>
                <tr>
                    <td colspan="2" style="text-align: center;">考核指标</td>
                    <td style="text-align: center;">完成情况</td>
                    <td style="text-align: center;">完成情况描述</td>
                </tr>

                <tr id="TECHNICAL_INDICATORS" class="stageKpi">

                </tr>

                <tr id="ECONOMIC_INDICATORS" class="stageKpi">
                </tr>

                <tr id="INDICATORS_OF_TALENT_TEAM_CONS" class="stageKpi">
                </tr>

                <tr id="OTHER_INDICATORS" class="stageKpi">
                </tr>

                <tr>
                    <td>项目重要进展情况描述：</td>
                    <td colspan="3">
                        <textarea placeholder="项目重要进展情况描述" class="layui-textarea form-control"
                                  lay-verify="required"
                                  id="importanceDescribe" name="importanceDescribe"></textarea>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="module">
            <table class="layui-table">
                <colgroup>
                    <col width="3%">
                    <col width="25%">
                    <col width="24%">
                    <col width="24%">
                    <col width="24%">
                </colgroup>
                <tbody id="userinfo">
                <tr class="td-text">
                    <td rowspan="6" class="table-info">项目经费管理情况</td>
                </tr>
                <tr>
                    <td>项目资金是否单独核算 :</td>
                    <td colspan="3">
                        <input type="radio" name="isOneCheck" value="是" title="是">
                        <input type="radio" name="isOneCheck" value="否" title="否">
                    </td>
                </tr>
                <tr>
                    <td>单独核算形式：</td>
                    <td colspan="3">
                        <input type="radio" name="oneCheckType" value="专账核算" title="专账核算">
                        <input type="radio" name="oneCheckType" value="往来账核算" title="往来账核算">
                        <input type="radio" name="oneCheckType" value="辅助账核算" title="辅助账核算">
                        <input type="radio" name="oneCheckType" value="其他" title="其他">
                    </td>
                </tr>
                <tr>
                    <td colspan="4">项目资金收支情况（截至报告期限）</td>
                </tr>
                <tr>
                    <td>收入</td>
                    <td>支出</td>
                    <td>其中劳务费支出</td>
                    <td>其中缴费支出</td>
                </tr>
                <tr>
                    <td><input class="form-control" placeholder="收入" type="text" name="allIncome" id="allIncome"
                               data-bv-notempty="true"></td>
                    <td><input class="form-control" placeholder="支出" type="text" name="allExpend" id="allExpend"
                               data-bv-notempty="true"></td>
                    <td><input class="form-control" placeholder="其中劳务费支出" type="text" name="labourExpend"
                               id="labourExpend" data-bv-notempty="true"></td>
                    <td><input class="form-control" placeholder="其中缴费支出" type="text" name="performanceExpend"
                               id="performanceExpend" data-bv-notempty="true"></td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="module">
            <table class="layui-table">
                <colgroup>
                    <col width="3%">
                    <col width="10%">
                    <col width="10%">
                    <col width="10%">
                    <col width="10%">
                    <col width="10%">
                    <col width="10%">
                    <col width="9%">
                    <col width="9%">
                    <col width="9%">
                </colgroup>
                <tbody id="userinf">
                <tr class="td-text">
                    <td rowspan="100" class="table-info">项目经费使用情况</td>
                </tr>
                <tr>
                    <td rowspan="2" colspan="2">科目</td>
                    <td rowspan="2">支出金额</td>
                    <td colspan="2">其中：广西科技厅资助经费 （如为先验收后补助项目，则此处经费 为乙方自筹经费中的科技经费）</td>
                    <td rowspan="2" colspan="4">开支内容</td>
                </tr>
                <tr class="stageFundUse">
                    <td>合同原始预算</td>
                    <td>已支出金额</td>
                </tr>

                <tr>
                    <td colspan="9"><h3>项目其他经费支出情况（如为先验收后补助项目，则此处经费不包含自筹经费中的科技经费）</h3></td>
                </tr>
                <tr>
                    <td>国家科技部门拨款</td>
                    <td>国家其他部门拨款</td>
                    <td>区级部门拨款</td>
                    <td>市级部门拨款</td>
                    <td>县级部门拨款</td>
                    <td>自筹资金</td>
                    <td>银行贷款</td>
                    <td>国外资金</td>
                    <td>其他资金</td>
                </tr>
                <tr>
                    <td><input class="form-control" type="text" name="stateSkillDeptAppropriation"
                               id="stateSkillDeptAppropriation"></td>
                    <td><input class="form-control" type="text" name="stateOtherDeptAppropriation"
                               id="stateOtherDeptAppropriation"></td>
                    <td><input class="form-control" type="text" name="districtDeptAppropriation"
                               id="districtDeptAppropriation"></td>
                    <td><input class="form-control" type="text" name="cityDeptAppropriation" id="cityDeptAppropriation">
                    </td>
                    <td><input class="form-control" type="text" name="countyDeptAppropriation"
                               id="countyDeptAppropriation"></td>
                    <td><input class="form-control" type="text" name="selfRaisedFund" id="selfRaisedFund"></td>
                    <td><input class="form-control" type="text" name="bankLoan" id="bankLoan"></td>
                    <td><input class="form-control" type="text" name="foreignFund" id="foreignFund"></td>
                    <td><input class="form-control" type="text" name="otherFund" id="otherFund"></td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="module">
            <table class="layui-table">
                <colgroup>
                    <col width="3%">
                    <col width="3%">
                    <col width="10%">
                    <col width="10%">
                    <col width="10%">
                    <col width="10%">
                    <col width="10%">
                    <col width="10%">
                    <col width="27%">
                    <col width="7%">
                </colgroup>
                <tbody>
                <tr style="font-size: 14px;font-weight: bolder;">
                    <td rowspan="100" class="table-info">项目效益及成果情况</td>
                    <td colspan="9"><h3>（一）项目效益及成果基本情况</h3></td>
                </tr>
                <tr class="stageTarget">
                    <td colspan="7" style="text-align: center;">效益/成果名称</td>
                    <td style="text-align: center;" colspan="2">数量</td>
                </tr>
                <tr>
                    <td colspan="9"></td>
                </tr>
                <tr class="stagePaperCatalogue">
                    <td colspan="9">
                        <h3 style="float: left">（二）专著、论文目录</h3>
                        <button class="layui-btn layui-btn-sm" type="button" style="float: right"
                                onclick="addTr('stagePaperCatalogue')">
                            <i class="layui-icon">&#xe608;</i> 添加
                        </button>
                    </td>
                </tr>
                <tr class="stagePaperCatalogue">
                    <td>序号</td>
                    <td>专利、论文标题</td>
                    <td>完成人</td>
                    <td>项目负责人排位</td>
                    <td>发表时间</td>
                    <td>论文收录类别</td>
                    <td>论文他人引用次数</td>
                    <td>有关说明</td>
                    <td>操作</td>
                </tr>
                <tr>
                    <td colspan="9"></td>
                </tr>
                <tr class="stagePatentCatalogue">
                    <td colspan="9">
                        <h3 style="float: left">（三）授权专利目录</h3><span style="color: #ac2925">(注：填写的专利必须为该项目研究产生的专利，且项目组人员必须为专利完成人.)</span>
                        <button class="layui-btn layui-btn-sm" type="button" style="float: right"
                                onclick="addTr('stagePatentCatalogue')">
                            <i class="layui-icon">&#xe608;</i> 添加
                        </button>
                    </td>
                </tr>
                <tr class="stagePatentCatalogue">
                    <td>序号</td>
                    <td>专利编号</td>
                    <td>专利名称</td>
                    <td>完成人</td>
                    <td>专利类型</td>
                    <td>申请专利时间</td>
                    <td>专利授权时间</td>
                    <td>有关说明</td>
                    <td>操作</td>
                </tr>
                <tr>
                    <td colspan="9"></td>
                </tr>
                <tr class="stageScienceAchievementAwardCatalogue">
                    <td colspan="9">
                        <h3 style="float: left">（四）科技成果奖励目录</h3>
                        <button class="layui-btn layui-btn-sm" type="button" style="float: right"
                                onclick="addTr('stageScienceAchievementAwardCatalogue')">
                            <i class="layui-icon">&#xe608;</i> 添加
                        </button>
                    </td>
                </tr>
                <tr class="stageScienceAchievementAwardCatalogue">
                    <td>序号</td>
                    <td colspan="2">成果名称</td>
                    <td>完成人</td>
                    <td>项目负责人排位</td>
                    <td>获奖时间</td>
                    <td>奖励类别</td>
                    <td>有关说明</td>
                    <td>操作</td>
                </tr>
                <tr>
                    <td colspan="9"></td>
                </tr>
                <tr class="stageScienceAchievementRegisterCatalogue">
                    <td colspan="9">
                        <h3 style="float: left">（五）科技成果登记目录</h3>
                        <button class="layui-btn layui-btn-sm" type="button" style="float: right"
                                onclick="addTr('stageScienceAchievementRegisterCatalogue')">
                            <i class="layui-icon">&#xe608;</i> 添加
                        </button>
                    </td>
                </tr>
                <tr class="stageScienceAchievementRegisterCatalogue">
                    <td>序号</td>
                    <td colspan="2">登记号</td>
                    <td colspan="2">成果名称</td>
                    <td colspan="2">第一完成单位</td>
                    <td>第一完成人</td>
                    <td>操作</td>
                </tr>
                <tr>
                    <td colspan="9"></td>
                </tr>
                <tr class="stageTechnologyPactRegisterCatalogue">
                    <td colspan="9">
                        <h3 style="float: left">（六）技术合同认定登记目录</h3>
                        <button class="layui-btn layui-btn-sm" type="button" style="float: right"
                                onclick="addTr('stageTechnologyPactRegisterCatalogue')">
                            <i class="layui-icon">&#xe608;</i> 添加
                        </button>
                    </td>
                </tr>
                <tr class="stageTechnologyPactRegisterCatalogue">
                    <td>序号</td>
                    <td colspan="2">技术合同编号</td>
                    <td>技术合同名称</td>
                    <td>卖方单位</td>
                    <td>合同成交金额</td>
                    <td>技术交易金额</td>
                    <td>技术合同类型</td>
                    <td>操作</td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="module">
            <table class="layui-table">
                <colgroup>
                    <col width="3%">
                    <col width="97%">
                </colgroup>
                <tbody id="userinfo11">
                <tr class="td-text">
                    <td rowspan="6" class="table-info">项目负责人承诺及单位意见</td>
                </tr>
                <tr class="principalCheckStage">
                    <td>
                        <span style="font-weight: bold">项目负责人承诺/意见：</span>
                        <span class="principalCheck"></span></br>
<!--                        <div class="layui-form-item">-->
<!--                            <label class="layui-form-label">负责人审核结果:</label>-->
<!--                            <div class="layui-input-block">-->
<!--                                <input type="radio" name="principalCheckEnable" value="1" title="同意">-->
<!--                                <input type="radio" name="principalCheckEnable" value="-1" title="驳回">-->
<!--                            </div>-->
<!--                        </div>-->
                        <span style="font-weight: bold">项目负责人：</span><span class="principal"></span></br>
                        <span style="font-weight: bold">审核时间：</span>
                        <span class="principalCheckTime"></span>
                    </td>
                </tr>
                <tr class="deptCheckStage">
                    <td>
                        项目第一承担单位对项目完成质量评价意见</br>
<!--                        <label>1.项目完成情况</label>-->
<!--                        <div class="layui-input-block">-->
<!--                            <input type="radio" lay-skin="primary" name="projectCompletion" value="按计划进度实施" title="按计划进度实施" >-->
<!--                        </div>-->
<!--                        <div class="layui-input-block">-->
<!--                            <input type="radio" lay-skin="primary" name="projectCompletion" value="基本按计划进度实施" title="基本按计划进度实施">-->
<!--                        </div>-->
<!--                        <div class="layui-input-block">-->
<!--                            <input type="radio" lay-skin="primary" name="projectCompletion" value="未按计划进度实施" title="未按计划进度实施">-->
<!--                        </div>-->
                        <span style="font-weight: bold">单位意见：</span>
                        <span class="deptCheck"></span></br>
<!--                        <div class="layui-form-item">-->
<!--                            <label class="layui-form-label">单位审核结果:</label>-->
<!--                            <div class="layui-input-block">-->
<!--                                <input type="radio" name="deptCheckEnable" value="1" title="同意">-->
<!--                                <input type="radio" name="deptCheckEnable" value="-1" title="驳回">-->
<!--                            </div>-->
<!--                        </div>-->
                        <span style="font-weight: bold">经办人：</span><span class="deptCheckUser"></span></br>
                        <span style="font-weight: bold">审核时间：</span>
                        <span class="deptCheckTime"></span>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="module">
            <table class="layui-table">
                <colgroup>
                    <col width="3%">
                    <col width="30%">
                    <col width="52%">
                    <col width="15">
                </colgroup>
                <tbody id="file_table">
                <tr class="td-text">
                    <td rowspan="100" class="table-info">附件清单</td>
                </tr>
                <tr>
                    <td colspan="3" style="text-align: right">
                        <button type="button" class="layui-btn" id="upload_file">
                            <i class="layui-icon">&#xe67c;</i>上传附件
                        </button>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: center;">附件名称</td>
                    <td style="text-align: center;">附件说明</td>
                    <td style="text-align: center;">操作</td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="form-actions" style="margin-bottom: 50px;">
            <div class="row" align="center">
                <div class="col-md-12">
                    <button class="btn btn-primary" type="button" onclick=" history.back(-1);">返回</button>
                    <button class="btn btn-primary" type="button" onclick="update();">
                        <i class="fa fa-save"></i> 保存修改
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>
</body>
<script type="text/javascript" src='../../../../js/constant.js'></script>
<script type="text/javascript" src="../../../../js/libs/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../../../../js/jq.js"></script>
<script type="text/javascript" src="../../../../layui/layui.js"></script>
<script type="text/javascript" src='../../../../js/common.js'></script>
<script type="text/javascript" src='../../js/serializeJson.js'></script>
<script type="text/javascript" src='../../js/initSelectData.js'></script>
<script type="text/javascript" src='../../js/saveData.js'></script>
<script type="text/javascript" src="../../../../js/my/permission.js"></script>
<script>
    var pers = checkPermission();
    var stageId = getUrlParam("id");
    var userId = getUrlParam("user_id");
    ///序号
    var paperIndex = 0;
    var patentIndex = 0;
    var scienceAchievementAwardIndex = 0;
    var scienceAchievementRegisterIndex = 0;
    var technologyPactRegisterIndex = 0;



    var laydate, form,layer;
    layui.use(['layer', 'form', 'laydate', 'upload'], function () {
        var upload = layui.upload;
        layer = layui.layer;
        form = layui.form;
        laydate = layui.laydate;
        lay('.date').each(function () {
            laydate.render({
                elem: this
                , showBottom: false
                , trigger: 'click'
            });
        });
        upload.render({
            elem: '#upload_file' //绑定元素
            , accept: 'file'
            , multiple: true
            , url: domainName + '/zuul/api-f/files'
            , allDone: function (obj) { //当文件全部被提交后，才触发
                console.log(obj.total); //得到总文件数
                console.log(obj.successful); //请求成功的文件数
                console.log(obj.aborted); //请求失败的文件数
            }
            , done: function (res, index, upload) {
                layer.msg("上传成功");
                var url = res['url'];
                var id = res['id'];
                var str = '';
                str += '<tr id="' + id + '" class="stageAffixFile"><input type="hidden" name="fileName" value="' + res['name'] + '" ><input type="hidden" name="fileId" value="' + id + '" ><td>' + res.name + '</td><td>';
                str += '<textarea placeholder="文件说明" class="layui-textarea form-control"lay-verify="required" name="fileRemark"></textarea></td>';
                str += '<td><button class="layui-btn layui-btn-xs" type="button" onclick="deleteFile(\'' + id + '\')"><i class="layui-icon">&#xe705;</i>删除</button>';
                str += '<a class="layui-btn layui-btn-xs" href="' + url + '"><input type="hidden" name="fileUrl" value="' + url + '" ><i class="layui-icon">&#xe601;</i>下载</a></td></tr>';
                $("#file_table").append(str);
            }
        });
        //初始化项目信息
        $.get(domainName + "/api-summary/stage/" + stageId, function (res) {
            for (var key in res) {
                $("." + key).html(res[key]);
                $("#" + key).val(res[key]);
            }

            $('.deptCheckTime').html(formatDate4(res.deptCheckTime));
            $('.principalCheckTime').html(formatDate4(res.principalCheckTime));
            $('.createTime').html(formatDate4(res.createTime));
            $('#extensionTime').val(formatDate4(res.extensionTime));

            var causesInput = $('input[name=causes]');
            var causesVal = (res.cause).split(',');
            for (var i = 0; i < causesInput.length; i++) {
                for (var j = 0; j < causesVal.length; j++) {
                    if ($(causesInput[i]).val() == causesVal[j]) {
                        $(causesInput[i]).prop('checked', true);
                    }
                }
            }
            setRadio($('input[name=applicantExtension]'),res.applicantExtension);
            setRadio($('input[name=produceLearnResearch]'),res.produceLearnResearch);
            setRadio($('input[name=innovateType]'),res.innovateType);
            setRadio($('input[name=collaborate]'),res.collaborate);
            setRadio($('input[name=skillSourceDept]'),res.skillSourceDept);
            setRadio($('input[name=progress]'),res.progress);
            setRadio($('input[name=isOneCheck]'),res.isOneCheck);
            setRadio($('input[name=oneCheckType]'),res.oneCheckType);

            form.render();
            if (res.otherTarget != null) {
                var str1 = '';
                str1 += '<td>其他指标</td><td><span>' + res.otherTarget + '</span><input type="hidden" name="otherTarget" value="' + res.otherTarget + '"></td>';
                str1 += '<td><textarea placeholder="完成情况" class="layui-textarea form-control" lay-verify="required"';
                str1 += 'id="otherTargetSchedule" name="otherTargetSchedule">'+ res.otherTargetSchedule +'</textarea></td>';
                str1 += '<td><textarea placeholder="完成情况描述" class="layui-textarea form-control" lay-verify="required"';
                str1 += 'id="otherTargetDescribe" name="otherTargetDescribe">'+ res.otherTargetDescribe +'</textarea></td>';
                $("#OTHER_INDICATORS").append(str1);
            }
            if (res.skillTarget != null) {
                var str = '';
                str += '<td>技术指标</td><td><span>' + res.skillTarget + '</span><input type="hidden" name="skillTarget" value="' + res.skillTarget + '"></td>';
                str += '<td><textarea placeholder="完成情况" class="layui-textarea form-control" lay-verify="required"';
                str += 'id="skillTargetSchedule" name="skillTargetSchedule">'+ res.skillTargetSchedule +'</textarea></td>';
                str += '<td><textarea placeholder="完成情况描述" class="layui-textarea form-control" lay-verify="required"';
                str += 'id="skillTargetDescribe" name="skillTargetDescribe">'+ res.skillTargetDescribe +'</textarea></td>';
                $("#TECHNICAL_INDICATORS").append(str);
            }
            if (res.economyTarget != null) {
                var str = '';
                str += '<td>经济指标</td><td><span>' + res.economyTarget + '</span><input type="hidden" name="economyTarget" value="' + res.economyTarget + '"></td>';
                str += '<td><textarea placeholder="完成情况" class="layui-textarea form-control" lay-verify="required"';
                str += 'id="economyTargetSchedule" name="economyTargetSchedule">'+ res.economyTargetSchedule +'</textarea></td>';
                str += '<td><textarea placeholder="完成情况描述" class="layui-textarea form-control" lay-verify="required"';
                str += 'id="economyTargetDescribe" name="economyTargetDescribe">'+ res.economyTargetDescribe +'</textarea></td>';
                $("#ECONOMIC_INDICATORS").append(str);
            }
            if (res.personTarget != null) {
                var str = '';
                str += '<td>人才队伍建设指标</td><td><span>' + res.personTarget + '</span><input type="hidden" name="personTarget" value="' + res.personTarget + '"></td>';
                str += '<td><textarea placeholder="完成情况" class="layui-textarea form-control" lay-verify="required"';
                str += 'id="personTargetSchedule" name="personTargetSchedule">'+ res.personTargetSchedule +'</textarea></td>';
                str += '<td><textarea placeholder="完成情况描述" class="layui-textarea form-control" lay-verify="required"';
                str += 'id="personTargetDescribe" name="personTargetDescribe">'+ res.personTargetDescribe +'</textarea></td>';
                $("#INDICATORS_OF_TALENT_TEAM_CONS").append(str);
            }
            var stageFundUses = res.stageFundUses;
            var STR_stageFundUses = '';
            for (var i = 0; i < stageFundUses.length; i++) {
                STR_stageFundUses += '<tr class="stageFundUse">';
                STR_stageFundUses += '<td colspan="2">'+stageFundUses[i].fundUseSubject+'<input class="form-control" type="hidden" name="fundUseSubject" value="'+stageFundUses[i].fundUseSubject+'"></td>';
                STR_stageFundUses += '<td><input class="form-control" type="text" name="fundUseExpenditure" value="' + stageFundUses[i].fundUseExpenditure + '">';
                STR_stageFundUses += '<input class="form-control" type="hidden" name="id" value="'+stageFundUses[i].id+'"></td>';
                STR_stageFundUses += '<td><input class="form-control" type="text" name="fundUseOriginalBudget" value="' + stageFundUses[i].fundUseOriginalBudget + '"></td>';
                STR_stageFundUses += '<td><input class="form-control" type="text" name="fundUseExpenditureOut" value="' + stageFundUses[i].fundUseExpenditureOut + '"></td>';
               if(stageFundUses[i].fundUseRemark == '/'){
                   STR_stageFundUses += '<td colspan="4">' + stageFundUses[i].fundUseRemark + '</td></tr>';
               }else{
                   STR_stageFundUses += '<td colspan="4"><textarea class="layui-textarea form-control" name="fundUseRemark">' + stageFundUses[i].fundUseRemark + '</textarea></td></tr>';
               }
            }
            $('.stageFundUse').after(STR_stageFundUses);
            var stageAffixFiles = res.stageAffixFiles;
            var STR_stageAffixFiles = '';
            for (var i = 0; i < stageAffixFiles.length; i++) {
                STR_stageAffixFiles += '<tr id="' + stageAffixFiles[i].fileId + '" class="stageAffixFile"><input type="hidden" name="fileName" value="' + stageAffixFiles[i].fileName +'" >';
                STR_stageAffixFiles += '<input type="hidden" name="id" value="' + stageAffixFiles[i].id + '" >';
                STR_stageAffixFiles += '<input type="hidden" name="fileId" value="' + stageAffixFiles[i].fileId + '" ><td>' + stageAffixFiles[i].fileName  + '</td><td>';
                STR_stageAffixFiles += '<textarea placeholder="文件说明" class="layui-textarea form-control"lay-verify="required" name="fileRemark">'+ stageAffixFiles[i].fileRemark +'</textarea></td>';
                STR_stageAffixFiles += '<td><button class="layui-btn layui-btn-xs" type="button" onclick="delStageAffixFile(\'' + stageAffixFiles[i].fileId + '\','+ stageAffixFiles[i].id +');">';
                STR_stageAffixFiles += '<i class="layui-icon">&#xe705;</i>删除</button>';
                STR_stageAffixFiles += '<a class="layui-btn layui-btn-xs" href="' + stageAffixFiles[i].fileUrl + '"><input type="hidden" name="fileUrl" value="' + stageAffixFiles[i].fileUrl + '" >';
                STR_stageAffixFiles += '<i class="layui-icon">&#xe601;</i>下载</a></td></tr>';
            }
            $("#file_table").append(STR_stageAffixFiles);
            var stagePaperCatalogues = res.stagePaperCatalogues;
            paperIndex = stagePaperCatalogues.length;
            var STR_stagePaperCatalogues = '';
            for (var i = 0; i < stagePaperCatalogues.length; i++) {
                STR_stagePaperCatalogues += '<tr class="stagePaperCatalogue">';
                STR_stagePaperCatalogues += '<td>' + (i + 1) + '<input class="form-control" type="hidden" name="id" value="'+stagePaperCatalogues[i].id+'"></td>';
                STR_stagePaperCatalogues += '<td><input class="form-control" type="text" name="paperTitle" value="' + stagePaperCatalogues[i].paperTitle + '"></td>';
                STR_stagePaperCatalogues += '<td><input class="form-control" type="text" name="paperPersonCharge" value="' + stagePaperCatalogues[i].paperPersonCharge + '"></td>';
                STR_stagePaperCatalogues += '<td><input class="form-control" type="text" name="paperLeaderRank" value="' + stagePaperCatalogues[i].paperLeaderRank + '"></td>';
                STR_stagePaperCatalogues += '<td><input class="form-control date" type="text" name="paperPostedTime" value="' + formatDate4(stagePaperCatalogues[i].paperPostedTime) + '"></td>';
                STR_stagePaperCatalogues += '<td><input class="form-control" type="text" name="paperCategory" value="' + stagePaperCatalogues[i].paperCategory + '"></td>';
                STR_stagePaperCatalogues += '<td><input class="form-control" type="text" name="paperCitationsSum" value="' + stagePaperCatalogues[i].paperCitationsSum + '"></td>';
                STR_stagePaperCatalogues += '<td><textarea class="layui-textarea form-control" name="paperRemark">' + stagePaperCatalogues[i].paperRemark + '</textarea></td>';
                STR_stagePaperCatalogues += '<td><button class="layui-btn layui-btn-sm" style="float: right;background-color: #a90329" onclick="delTr(this)"><i class="layui-icon">&#xe640;</i>删除</button></td>';
                STR_stagePaperCatalogues += '</tr>';
            }
            $("tr.stagePaperCatalogue:last").after(STR_stagePaperCatalogues);
            var stagePatentCatalogues = res.stagePatentCatalogues;
            stagePatentCatalogues.length;
            var STR_stagePatentCatalogues = '';
            for (var i = 0; i < stagePatentCatalogues.length; i++) {
                STR_stagePatentCatalogues += '<tr class="stagePatentCatalogue">';
                STR_stagePatentCatalogues += '<td>' + (i + 1) + '<input class="form-control" type="hidden" name="id" value="' + stagePatentCatalogues[i].id + '"></td>';
                STR_stagePatentCatalogues += '<td><input class="form-control" type="text" name="patentNumber" value="' + stagePatentCatalogues[i].patentNumber + '"></td>';
                STR_stagePatentCatalogues += '<td><input class="form-control" type="text" name="patentName" value="' + stagePatentCatalogues[i].patentName + '"></td>';
                STR_stagePatentCatalogues += '<td><input class="form-control" type="text" name="patentPersonCharge" value="' + stagePatentCatalogues[i].patentPersonCharge + '"></td>';
                STR_stagePatentCatalogues += '<td><input class="form-control" type="text" name="patentType" value="' + stagePatentCatalogues[i].patentType + '"></td>';
                STR_stagePatentCatalogues += '<td><input class="form-control date" type="text" name="patentApplicationTime" value="' + formatDate4(stagePatentCatalogues[i].patentApplicationTime) + '"></td>';
                STR_stagePatentCatalogues += '<td><input class="form-control date" type="text" name="patentAuthorizeTime" value="' + formatDate4(stagePatentCatalogues[i].patentAuthorizeTime) + '"></td>';
                STR_stagePatentCatalogues += '<td><textarea class="layui-textarea form-control" name="patentRemark">' + stagePatentCatalogues[i].patentRemark + '</textarea></td>';
                STR_stagePatentCatalogues += '<td><button class="layui-btn layui-btn-sm" style="float: right;background-color: #a90329" onclick="delTr(this)"><i class="layui-icon">&#xe640;</i>删除</button></td>';
                STR_stagePatentCatalogues += '</tr>';
            }
            $("tr.stagePatentCatalogue:last").after(STR_stagePatentCatalogues);
            var stageScienceAchievementAwardCatalogues = res.stageScienceAchievementAwardCatalogues;
            scienceAchievementAwardIndex = stageScienceAchievementAwardCatalogues.length;
            var STR_stageScienceAchievementAwardCatalogues = '';
            for (var i = 0; i < stageScienceAchievementAwardCatalogues.length; i++) {
                STR_stageScienceAchievementAwardCatalogues += '<tr class="stageScienceAchievementAwardCatalogue">';
                STR_stageScienceAchievementAwardCatalogues += '<td>' + (i + 1) + '<input class="form-control" type="hidden" name="id" value="' + stageScienceAchievementAwardCatalogues[i].id + '"></td>';
                STR_stageScienceAchievementAwardCatalogues += '<td colspan="2"><input class="form-control" type="text" name="scienceAwardAchievementName" value="' + stageScienceAchievementAwardCatalogues[i].scienceAwardAchievementName + '"></td>';
                STR_stageScienceAchievementAwardCatalogues += '<td><input class="form-control" type="text" name="scienceAwardPersonCharge" value="' + stageScienceAchievementAwardCatalogues[i].scienceAwardPersonCharge + '"></td>';
                STR_stageScienceAchievementAwardCatalogues += '<td><input class="form-control" type="text" name="scienceAwardLeaderRank" value="' + stageScienceAchievementAwardCatalogues[i].scienceAwardLeaderRank + '"></td>';
                STR_stageScienceAchievementAwardCatalogues += '<td><input class="form-control date" type="text" name="scienceAwardGetTime" value="' + formatDate4(stageScienceAchievementAwardCatalogues[i].scienceAwardGetTime) + '"></td>';
                STR_stageScienceAchievementAwardCatalogues += '<td><input class="form-control" type="text" name="scienceAwardType" value="' + stageScienceAchievementAwardCatalogues[i].scienceAwardType + '"></td>';
                STR_stageScienceAchievementAwardCatalogues += '<td><textarea class="layui-textarea form-control" name="scienceAwardRemark">' + stageScienceAchievementAwardCatalogues[i].scienceAwardRemark + '</textarea></td>';
                STR_stageScienceAchievementAwardCatalogues += '<td><button class="layui-btn layui-btn-sm" style="float: right;background-color: #a90329" onclick="delTr(this)"><i class="layui-icon">&#xe640;</i>删除</button></td>';
                STR_stageScienceAchievementAwardCatalogues += '</tr>';
            }
            $("tr.stageScienceAchievementAwardCatalogue:last").after(STR_stageScienceAchievementAwardCatalogues);
            var stageScienceAchievementRegisterCatalogues = res.stageScienceAchievementRegisterCatalogues;
            scienceAchievementRegisterIndex = stageScienceAchievementRegisterCatalogues.length;
            var STR_stageScienceAchievementRegisterCatalogues = '';
            for (var i = 0; i < stageScienceAchievementRegisterCatalogues.length; i++) {
                STR_stageScienceAchievementRegisterCatalogues += '<tr class="stageScienceAchievementRegisterCatalogue">';
                STR_stageScienceAchievementRegisterCatalogues += '<td>' + (i + 1) + '<input class="form-control" type="hidden" name="id" value="' + stageScienceAchievementRegisterCatalogues[i].id + '"></td>';
                STR_stageScienceAchievementRegisterCatalogues += '<td colspan="2"><input class="form-control" type="text" name="scienceRegisterNumber"value="' + stageScienceAchievementRegisterCatalogues[i].scienceRegisterNumber + '"></td>';
                STR_stageScienceAchievementRegisterCatalogues += '<td colspan="2"><input class="form-control" type="text" name="scienceRegisterAchievementName"value="' + stageScienceAchievementRegisterCatalogues[i].scienceRegisterAchievementName + '"></td>';
                STR_stageScienceAchievementRegisterCatalogues += '<td colspan="2"><input class="form-control" type="text" name="scienceRegisterAccomplishDept"value="' + stageScienceAchievementRegisterCatalogues[i].scienceRegisterAccomplishDept + '"></td>';
                STR_stageScienceAchievementRegisterCatalogues += '<td><input class="form-control" type="text" name="scienceRegisterPersonCharge" value="' + stageScienceAchievementRegisterCatalogues[i].scienceRegisterPersonCharge + '"></td>';
                STR_stageScienceAchievementRegisterCatalogues += '<td><button class="layui-btn layui-btn-sm" style="float: right;background-color: #a90329" onclick="delTr(this)"><i class="layui-icon">&#xe640;</i>删除</button></td>';
                STR_stageScienceAchievementRegisterCatalogues += '</tr>';
            }
            $("tr.stageScienceAchievementRegisterCatalogue:last").after(STR_stageScienceAchievementRegisterCatalogues);
            var stageTechnologyPactRegisterCatalogues = res.stageTechnologyPactRegisterCatalogues;
            technologyPactRegisterIndex = stageTechnologyPactRegisterCatalogues.length;
            var STR_stageTechnologyPactRegisterCatalogues = '';
            for (var i = 0; i < stageTechnologyPactRegisterCatalogues.length; i++) {
                STR_stageTechnologyPactRegisterCatalogues += '<tr class="stageTechnologyPactRegisterCatalogue">';
                STR_stageTechnologyPactRegisterCatalogues += '<td>' + (i + 1) + '<input class="form-control" type="hidden" name="id" value="' + stageTechnologyPactRegisterCatalogues[i].id + '"></td>';
                STR_stageTechnologyPactRegisterCatalogues += '<td colspan="2"><input class="form-control" type="text" name="technologyPactNumber" value="' + stageTechnologyPactRegisterCatalogues[i].technologyPactNumber + '"></td>';
                STR_stageTechnologyPactRegisterCatalogues += '<td><input class="form-control" type="text" name="technologyPactName" value="' + stageTechnologyPactRegisterCatalogues[i].technologyPactName + '"></td>';
                STR_stageTechnologyPactRegisterCatalogues += '<td><input class="form-control layui-transfer-data" type="text" name="technologySellerDept" value="' + stageTechnologyPactRegisterCatalogues[i].technologySellerDept + '"></td>';
                STR_stageTechnologyPactRegisterCatalogues += '<td><input class="form-control" type="text" name="technologyPactVolumeTransaction" value="' + stageTechnologyPactRegisterCatalogues[i].technologyPactVolumeTransaction + '"></td>';
                STR_stageTechnologyPactRegisterCatalogues += '<td><input class="form-control" type="text" name="technologyVolumeTransaction" value="' + stageTechnologyPactRegisterCatalogues[i].technologyVolumeTransaction + '"></td>';
                STR_stageTechnologyPactRegisterCatalogues += '<td><input class="form-control" type="text" name="technologyPactType" value="' + stageTechnologyPactRegisterCatalogues[i].technologyPactType + '"></td>';
                STR_stageTechnologyPactRegisterCatalogues += '<td><button class="layui-btn layui-btn-sm" style="float: right;background-color: #a90329" onclick="delTr(this)"><i class="layui-icon">&#xe640;</i>删除</button></td>';
                STR_stageTechnologyPactRegisterCatalogues += '</tr>';
            }
            $("tr.stageTechnologyPactRegisterCatalogue:last").after(STR_stageTechnologyPactRegisterCatalogues);
            var stageTargets = res.stageTargets;
            var STR_stageTargets = '';
            for (var i = 0; i < stageTargets.length; i++) {
                STR_stageTargets += '<tr class="stageTarget">';
                STR_stageTargets += '<td class="td-text" colspan="7">' + stageTargets[i].targetName + '<input type="hidden" name="id" value="' + stageTargets[i].id + '"></td>';
                STR_stageTargets += '<td class="td-text" colspan="2"><input class="form-control" type="text" name="targetSum" value="' + stageTargets[i].targetSum + '"></td></tr>';
            }
            $("tr.stageTarget:last").after(STR_stageTargets);

            lay('.date').each(function () {
                laydate.render({
                    elem: this
                    , showBottom: false
                    , trigger: 'click'
                });
            });
        });
    });
    //设置单选框
    function setRadio(inputs,data) {
        for (var i = 0; i < inputs.length; i++) {
            if ($(inputs[i]).val() == data) {
                $(inputs[i]).prop('checked', true);
            }
        }
    }
    function update() {
        //处理附表数据
        var stagePatents = setObjectProperty('.stagePatentCatalogue');
        var stageAffixFiles = setObjectProperty('.stageAffixFile');
        var stageFundUses = setObjectProperty('.stageFundUse');
        var stagePaperCatalogues = setObjectProperty('.stagePaperCatalogue');
        var stageScienceAchievementAwardCatalogues = setObjectProperty('.stageScienceAchievementAwardCatalogue');
        var stageScienceAchievementRegisterCatalogues = setObjectProperty('.stageScienceAchievementRegisterCatalogue');
        var stageTechnologyPactRegisterCatalogues = setObjectProperty('.stageTechnologyPactRegisterCatalogue');
        var stageTargets = setObjectProperty('.stageTarget');
        var formData = $("#form").serializeObject();
        formData.stagePatentCatalogues = stagePatents;
        formData.stageAffixFiles = stageAffixFiles;
        formData.stageFundUses = stageFundUses;
        formData.stagePaperCatalogues = stagePaperCatalogues;
        formData.stageScienceAchievementAwardCatalogues = stageScienceAchievementAwardCatalogues;
        formData.stageScienceAchievementRegisterCatalogues = stageScienceAchievementRegisterCatalogues;
        formData.stageTechnologyPactRegisterCatalogues = stageTechnologyPactRegisterCatalogues;
        formData.stageTargets = stageTargets;
        formData.principalCheckEnable = 0;
        formData.deptCheckEnable = 0;
        formData.cause = (formData.causes).join(',');
        formData.enable = 0;
        formData.id = stageId;
        $.ajax({
            type: 'put',
            url: domainName + '/api-summary/stage',
            dataType: 'json',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(formData),
            success: function (res) {
                layer.msg("成功");
                $("#form").find("input,textarea").each(function () {
                    $(this).attr('disabled', false);
                });
            },
            error: function (res) {
                $("#form").find("input,textarea").each(function () {
                    $(this).attr('disabled', false);
                });
            }
        })
    }


    //处理List类型数据
    function setObjectProperty(attribute) {
        var target = $(attribute);
        var arr = new Array();
        for (var i = 0; i < target.length; i++) {
            var obj = {};
            var input = $(target[i]).find('input,textarea');
            var falg = false;
            for (var j = 0; j < input.length; j++) {
                falg = true;
                obj[$(input[j]).attr('name')] = $(input[j]).val();
                $(input[j]).attr('disabled', true)
            }
            if (falg) {
                arr.push(obj);
            }
            falg = false;
        }
        return arr;
    }

    function delStageAffixFile(fileId,id) {
        layer.confirm('确定要删除吗？', {
            btn: ['确定', '取消']
        }, function () {
            $.ajax({
                type: 'delete',
                url: domainName + '/api-f/files/' + fileId,
                success: function (data) {
                    layer.msg("成功");
                }
            });
            $.ajax({
                type: 'delete',
                url: domainName + '/api-summary/stageAffixFile/' + id,
                success: function (data) {
                }
            });
            $("#" + fileId).remove();
            layer.close(1);
        });
    }

    function deleteFile(id) {
        layer.confirm('确定要删除吗？', {
            btn: ['确定', '取消']
        }, function () {
            $.ajax({
                type: 'delete',
                url: domainName + '/api-f/files/' + id,
                success: function (data) {
                    layer.msg("成功");
                }
            });
            $("#" + id).remove();
            layer.close(1);
        });
    }

    //删除当前tr表格
    function delTr(obj) {
        layer.confirm('确定要删除吗？', {
            btn: ['确定', '取消']
        }, function () {
            var tr = $(obj).parents('tr');
            var input = $(tr).find('input[name=id]');
            if (input != null && input != undefined) {
                $.ajax({
                    type: 'delete',
                    url: domainName + '/api-summary/' + $(tr).attr('class') + '/' + $(input).val(),
                    success: function (data) {
                        layer.msg("成功");
                    }
                });
            }
            tr.remove();
            layer.close(1);
        });
    }

    //添加一个tr表格
    function addTr(type) {
        if (type == 'stagePaperCatalogue') {
            paperIndex++;
            var str = '';
            str += '<tr class="stagePaperCatalogue">';
            str += '<td>' + paperIndex + '</td>';
            str += '<td><input class="form-control" type="text" name="paperTitle"></td>';
            str += '<td><input class="form-control" type="text" name="paperPersonCharge"></td>';
            str += '<td><input class="form-control" type="text" name="paperLeaderRank"></td>';
            str += '<td><input class="form-control date" type="text" name="paperPostedTime"></td>';
            str += '<td><input class="form-control" type="text" name="paperCategory"></td>';
            str += '<td><input class="form-control" type="text" name="paperCitationsSum"></td>';
            str += '<td><textarea class="layui-textarea form-control" name="paperRemark"></textarea></td>';
            str += '<td><button class="layui-btn layui-btn-sm" style="float: right;background-color: #a90329" onclick="delTr(this)"><i class="layui-icon">&#xe640;</i>删除</button></td>';
            str += '</tr>';
            $("tr.stagePaperCatalogue:last").after(str);
            lay('.date').each(function () {
                laydate.render({
                    elem: this
                    , showBottom: false
                    , trigger: 'click'
                });
            });
            return;
        }
        if (type == 'stagePatentCatalogue') {
            patentIndex++;
            var str = '';
            str += '<tr class="stagePatentCatalogue">';
            str += '<td>' + patentIndex + '</td>';
            str += '<td><input class="form-control" type="text" name="patentNumber"></td>';
            str += '<td><input class="form-control" type="text" name="patentName"></td>';
            str += '<td><input class="form-control" type="text" name="patentPersonCharge"></td>';
            str += '<td><input class="form-control" type="text" name="patentType"></td>';
            str += '<td><input class="form-control date" type="text" name="patentApplicationTime"></td>';
            str += '<td><input class="form-control date" type="text" name="patentAuthorizeTime"></td>';
            str += '<td><textarea class="layui-textarea form-control" name="patentRemark"></textarea></td>';
            str += '<td><button class="layui-btn layui-btn-sm" style="float: right;background-color: #a90329" onclick="delTr(this)"><i class="layui-icon">&#xe640;</i>删除</button></td>';
            str += '</tr>';
            $("tr.stagePatentCatalogue:last").after(str);
            lay('.date').each(function () {
                laydate.render({
                    elem: this
                    , showBottom: false
                    , trigger: 'click'
                });
            });
            return;
        }
        if (type == 'stageScienceAchievementAwardCatalogue') {
            scienceAchievementAwardIndex++;
            var str = '';
            str += '<tr class="stageScienceAchievementAwardCatalogue">';
            str += '<td>' + scienceAchievementAwardIndex + '</td>';
            str += '<td colspan="2"><input class="form-control" type="text" name="scienceAwardAchievementName"></td>';
            str += '<td><input class="form-control" type="text" name="scienceAwardPersonCharge"></td>';
            str += '<td><input class="form-control" type="text" name="scienceAwardLeaderRank"></td>';
            str += '<td><input class="form-control date" type="text" name="scienceAwardGetTime"></td>';
            str += '<td><input class="form-control" type="text" name="scienceAwardType"></td>';
            str += '<td><textarea class="layui-textarea form-control" name="scienceAwardRemark"></textarea></td>';
            str += '<td><button class="layui-btn layui-btn-sm" style="float: right;background-color: #a90329" onclick="delTr(this)"><i class="layui-icon">&#xe640;</i>删除</button></td>';
            str += '</tr>';
            $("tr.stageScienceAchievementAwardCatalogue:last").after(str);
            lay('.date').each(function () {
                laydate.render({
                    elem: this
                    , showBottom: false
                    , trigger: 'click'
                });
            });
            return;
        }
        if (type == 'stageScienceAchievementRegisterCatalogue') {
            scienceAchievementRegisterIndex++;
            var str = '';
            str += '<tr class="stageScienceAchievementRegisterCatalogue">';
            str += '<td>' + scienceAchievementRegisterIndex + '</td>';
            str += '<td colspan="2"><input class="form-control" type="text" name="scienceRegisterNumber"></td>';
            str += '<td colspan="2"><input class="form-control" type="text" name="scienceRegisterAchievementName"></td>';
            str += '<td colspan="2"><input class="form-control" type="text" name="scienceRegisterAccomplishDept"></td>';
            str += '<td><input class="form-control" type="text" name="scienceRegisterPersonCharge"></td>';
            str += '<td><button class="layui-btn layui-btn-sm" style="float: right;background-color: #a90329" onclick="delTr(this)"><i class="layui-icon">&#xe640;</i>删除</button></td>';
            str += '</tr>';
            $("tr.stageScienceAchievementRegisterCatalogue:last").after(str);
            return;
        }
        if (type == 'stageTechnologyPactRegisterCatalogue') {
            technologyPactRegisterIndex++;
            var str = '';
            str += '<tr class="stageTechnologyPactRegisterCatalogue">';
            str += '<td>' + technologyPactRegisterIndex + '</td>';
            str += '<td colspan="2"><input class="form-control" type="text" name="technologyPactNumber"></td>';
            str += '<td><input class="form-control" type="text" name="technologyPactName"></td>';
            str += '<td><input class="form-control layui-transfer-data" type="text" name="technologySellerDept"></td>';
            str += '<td><input class="form-control" type="text" name="technologyPactVolumeTransaction"></td>';
            str += '<td><input class="form-control" type="text" name="technologyVolumeTransaction"></td>';
            str += '<td><input class="form-control" type="text" name="technologyPactType"></td>';
            str += '<td><button class="layui-btn layui-btn-sm" style="float: right;background-color: #a90329" onclick="delTr(this)"><i class="layui-icon">&#xe640;</i>删除</button></td>';
            str += '</tr>';
            $("tr.stageTechnologyPactRegisterCatalogue:last").after(str);
        }
    }

</script>
</html>