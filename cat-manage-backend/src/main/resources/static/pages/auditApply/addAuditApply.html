<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../layui/css/layui.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../item/css/newProjecy.css">
    <style>
        .layui-table td {
            position: initial;
        }

        .layui-textarea {
            min-height: 60px;
        }
    </style>
</head>
<body>
<table class="layui-table" lay-skin="nob" style="border-collapse: separate;">
    <colgroup>
        <col width="8%">
        <col width="3%">
        <col width="10%">
        <col width="28%">
        <col width="2%">
        <col width="10%">
        <col width="20">
        <col width="8%">
        <col width="3%">
        <col width="8%">
    </colgroup>
    <tbody>
    <tr style="height: 30px;">
        <td class="mainTd_0" rowspan="1" colspan="10"></td>
    </tr>
    <tr style="height: 22px;">
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
        <td class="mainTd_1" rowspan="1" colspan="8"></td>
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
    </tr>
    <tr style="height: 33px;">
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
        <td class="mainTd_1" rowspan="2" colspan="2" style=""></td>
        <td class="mainTd_1" rowspan="1" colspan="4" style="text-align: center;">
            <div class="headline">
                <span>科技计划项目查定申请书</span>
            </div>
        </td>
        <td class="mainTd_1" rowspan="1" colspan="1"></td>
        <td class="mainTd_1" rowspan="1" colspan="1"></td>
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
    </tr>
    <tr style="height: 25px;">
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
        <td class="mainTd_1" rowspan="1" colspan="6"></td>
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
    </tr>
    <tr style="height: 25px;">
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
        <td class="mainTd_1" rowspan="1" colspan="8" style="border-bottom: 1px solid #dadcde;"></td>
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
    </tr>
    <tr style="height: 30px;">
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
        <td class="mainTd_1" rowspan="1" colspan="8"></td>
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
    </tr>
    <!--基本信息-->
    <form id="form1">
        <tr style="height: 40px;">
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="6" style="background: #f6f6f6 !important;">
                <div class="subheading">
                    <span>丨 基本信息</span>
                </div>
            </td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
        </tr>
        <tr style="height: 24px;">
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="8"></td>
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
        </tr>
        <tr style="height: 40px;">
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1">
                <div class="field">
                    <span>合同编号</span>
                </div>
            </td>
            <td class="mainTd_1 tdDorder" rowspan="1" colspan="1">
                <div class="field">
                    <input type="hidden" name="id" id="item_id">
                    <input type="hidden" name="status" id="status">
                    <input type="text" name="contract_no">
                </div>
            </td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1">
                <div class="field">
                    <span>项目类别</span>
                </div>
            </td>
            <td class="mainTd_1 tdDorder" rowspan="1" colspan="2">
                <div class="field">
                    <input type="text" name="type">
                </div>
            </td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
        </tr>
        <tr style="height: 24px;">
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="8"></td>
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
        </tr>
        <tr style="height: 40px;">
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1">
                <div class="field">
                    <span>项目名称</span>
                </div>
            </td>
            <td class="mainTd_1 tdDorder" rowspan="1" colspan="1">
                <div class="field">
                    <input type="text" name="name">
                </div>
            </td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1">
                <div class="field">
                    <span>委托单位（甲方）</span>
                </div>
            </td>
            <td class="mainTd_1 tdDorder" rowspan="1" colspan="2">
                <div class="field">
                    <input type="text" name="entrusting_party">
                </div>
            </td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
        </tr>
        <tr style="height: 24px;">
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="8"></td>
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
        </tr>
        <tr style="height: 40px;">
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1">
                <div class="field">
                    <span>申报单位(乙方)</span>
                </div>
            </td>
            <td class="mainTd_1 tdDorder" rowspan="1" colspan="1">
                <div class="field">
                    <input type="text" name="responsible_unit" id="responsible_unit" readonly>
                </div>
            </td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1">
                <div class="field">
                    <span>单位地址</span>
                </div>
            </td>
            <td class="mainTd_1 tdDorder" rowspan="1" colspan="2">
                <div class="field">
                    <input type="text" name="address" id="address">
                </div>
            </td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
        </tr>
        <tr style="height: 24px;">
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="8"></td>
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
        </tr>
        <tr style="height: 40px;">
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1">
                <div class="field">
                    <span>项目负责人</span>
                </div>
            </td>
            <td class="mainTd_1 tdDorder" rowspan="1" colspan="1">
                <div class="field">
                    <input type="text" name="leaderName">
                </div>
            </td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1">
                <div class="field">
                    <span>联系电话</span>
                </div>
            </td>
            <td class="mainTd_1 tdDorder" rowspan="1" colspan="2">
                <div class="field">
                    <input type="text" name="leaderPhone">
                </div>
            </td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
        </tr>
    </form>
    </tbody>
</table>

<table class="layui-table" lay-skin="nob" style="border-collapse: separate;">
    <colgroup>
        <col width="8%">
        <col width="3%">
        <col width="10%">
        <col width="28%">
        <col width="2%">
        <col width="10%">
        <col width="20">
        <col width="8%">
        <col width="3%">
        <col width="8%">
    </colgroup>
    <tbody>
    <tr style="height: 30px;">
        <td class="mainTd_0" rowspan="1" colspan="10"></td>
    </tr>
    <tr style="height: 22px;">
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
        <td class="mainTd_1" rowspan="1" colspan="8"></td>
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
    </tr>
    <tr style="height: 33px;">
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
        <td class="mainTd_1" rowspan="2" colspan="2" style=""></td>
        <td class="mainTd_1" rowspan="1" colspan="4" style="text-align: center;">
            <div class="headline">
                <span>项目信息</span>
            </div>
        </td>
        <td class="mainTd_1" rowspan="1" colspan="1"></td>
        <td class="mainTd_1" rowspan="1" colspan="1"></td>
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
    </tr>
    <tr style="height: 25px;">
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
        <td class="mainTd_1" rowspan="1" colspan="6"></td>
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
    </tr>
    <tr style="height: 25px;">
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
        <td class="mainTd_1" rowspan="1" colspan="8" style="border-bottom: 1px solid #dadcde;"></td>
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
    </tr>
    <tr style="height: 30px;">
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
        <td class="mainTd_1" rowspan="1" colspan="8"></td>
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
    </tr>
    <!--基本信息-->
    <form id="form" onsubmit="return false" class="form-horizontal">
        <tr style="height: 40px;">
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="6" style="background: #f6f6f6 !important;">
                <div class="subheading">
                    <span>丨 指标查定详情</span>
                </div>
            </td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
        </tr>
        <tr style="height: 24px;">
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="8"></td>
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
        </tr>
        <tr style="height: 40px;">
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1">
                <div class="field">
                    <span>所需审查指标</span>
                </div>
            </td>
            <td class="mainTd_1 tdDorder" rowspan="1" colspan="1">
                <div class="input-group" id="target" data-status="true" data-type="1" data-sign="target">
                    <input class="form-control" id="target_id" name="target_id" type="hidden">
                    <input class="form-control" id="check_unit" name="check_unit" type="hidden">
                    <input class="form-control" id="manage_unit" name="manage_unit" type="hidden">
                    <input type="text" class="form-control" placeholder="所需审查指标" readonly="readonly" id="text5"
                           style="background-color: #ffffff;">
                    <span class="input-group-addon"><a>选择</a></span>
                </div>
            </td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="2"></td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
        </tr>
        <tr style="height: 24px;">
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="8"></td>
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
        </tr>
        <tr style="height: 40px;">
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1">
                <div class="field">
                    <span>建议查定时间</span>
            </div>
            </td>
            <td class="mainTd_1 tdDorder" rowspan="1" colspan="1">
                <div class="field">
                    <input type="text" name="period" id="period" placeholder="请选择时间范围" class="form-control date" style="background-color: #ffffff;" data-bv-notempty="true"
                           data-bv-notempty-message="时间范围 不能为空" readonly>

                </div>
            </td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="2"></td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
        </tr>
        <tr style="height: 24px;">
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="8"></td>
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
        </tr>


        <tr style="height: 24px;">
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="8"></td>
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
        </tr>
        <tr style="height: 40px;">
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1">
                <div class="field">
                    <span>申请详情</span>
                </div>
            </td>
            <td class="mainTd_1 tdDorder" rowspan="1" colspan="5">
                <div class="field">
                    <textarea placeholder="请输入内容" class="layui-textarea" id="content" name="content"></textarea>
                </div>
            </td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
        </tr>
        <tr style="height: 24px;">
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="8"></td>
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
        </tr>
        <tr style="height: 40px;">
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>

            <td class="mainTd_1" rowspan="1" colspan="6">
                <div class="form-actions">
                    <div class="row" align="center">
                        <div class="col-md-12">
                            <button class="btn btn-primary" type="submit" onclick="add(this)">
                                <i class="fa fa-save"></i> 提交
                            </button>
                        </div>
                    </div>
                </div>
            </td>
            <td class="mainTd_1" rowspan="1" colspan="1"></td>
            <td class="mainTd_0" rowspan="1" colspan="1"></td>
        </tr>
    </form>
    </tbody>
</table>


<table class="layui-table" lay-skin="nob" style="border-collapse: separate;">
    <colgroup>
        <col width="8%">
        <col width="3%">
        <col width="10%">
        <col width="28%">
        <col width="2%">
        <col width="10%">
        <col width="20">
        <col width="8%">
        <col width="3%">
        <col width="8%">
    </colgroup>
    <tbody>
    <tr style="height: 25px;">
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
        <td class="mainTd_1" rowspan="1" colspan="8" style="border-bottom: 1px solid #dadcde;"></td>
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
    </tr>
    <tr style="height: 40px;">
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
        <td class="mainTd_1" rowspan="1" colspan="1"></td>
        <td class="mainTd_1" rowspan="1" colspan="6">
            <div class="indicators">
                <form>
                    <table class="layui-table">
                        <colgroup>
                            <col width="10%">
                            <col width="60%">

                            <col width="30%">
                        </colgroup>
                        <thead>
                        <tr style="background-color: #ffffff;">
                            <th class="tdDorder border-right-none" rowspan="1" colspan="5">
                                <div class="field">
                                    <span id="targets">查定指标</span>
                                </div>
                            </th>
                        </tr>
                        <tr>
                            <th class="tdDorder">序号</th>
                            <th class="tdDorder">指标内容</th>
                            <th class="tdDorder">实施地点</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </form>
            </div>
        </td>
        <td class="mainTd_1" rowspan="1" colspan="1"></td>
        <td class="mainTd_0" rowspan="1" colspan="1"></td>
    </tr>
    </tbody>
</table>
</div>

<script src="../../js/constant.js"></script>
<script type="text/javascript" src="../../js/libs/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../../js/plugin/bootstrapvalidator/bootstrapValidator.min.js"></script>
<script type="text/javascript" src="../../js/jq.js"></script>
<script type="text/javascript" src="../../layui/layui.all.js"></script>
<script type="text/javascript" src="../../js/common.js"></script>
<script type="text/javascript" src='../list-layout/js/initSelectData.js'></script>
<script type="text/javascript" src='js/auditApply.js'></script>
<script type="text/javascript">
    var itemId = getUrlParam("item_id");
    var userId = getUrlParam("userId");
   var choose = 0;
    var index, layer, upload, laydate, form;
    layui.use(['layedit', 'upload', 'laydate', 'layer', 'form'], function () {
        layer = layui.layer;
        laydate = layui.laydate;
        upload = layui.upload;
        form = layui.form;
        var $ = layui.$, slider = layui.slider;
        lay('.date').each(function () {
            laydate.render({
                elem: this
                , range: true
                , trigger: 'click'
            });
        });
        $($("div[data-sign]")).click(function () {
            var signs = $("#target_id").val();
            var name = $(this).attr("id");
            var element = '<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" id="labelList"><form class="layui-form" onsubmit="return false" id="LabelForm"><div class="layui-form-item"><div class="layui-input-block" id="label">';
            $.ajax({
                type: 'get',
                url: domainName + '/project-item/item/indicators/list',
                contentType: "application/json; charset=utf-8",
                data: {item_id: itemId},
                success: function (data) {
                    for (var i = 0; i < data.length; i++) {
                        var d = data[i];
                        var code = d.id;
                        var count = d.count;
                        var content = d.content;
                        var start_date = d.start_date;
                        var end_date = d.end_date;
                        var site = d.site;
                        var userIds = d.userIds;
                        if (count != null) {

                        } else {
                            if (signs.includes(code)) {
                                element += '<input type="checkbox" name="' + name + '" id="' + code + '" value="' + code + '" title="' + content + ' "  checked="checked" data-start_date="' + start_date + '" data-end_date="' + end_date + '" data-site="' + site + '" data-userIds="' + userIds + '"><div class="layui-unselect layui-form-checkbox"><span>' + content + '</span><i class="layui-icon layui-icon-ok"></i></div>';

                            } else {
                                element += '<input type="checkbox" name="' + name + '" id="' + code + '" value="' + code + '" title="' + content + '" data-start_date="' + start_date + '" data-end_date="' + end_date + '" data-site="' + site + '" data-userIds="' + userIds + '"><div class="layui-unselect layui-form-checkbox"><span>' + content + '</span><i class="layui-icon layui-icon-ok"></i></div>';
                            }
                        }
                    }
                    element += '</div></div><div class="layui-form-item"><div class="layui-input-block"><button class="layui-btn" onclick="back()">返回</button><button class="layui-btn" onclick="' + name + 'SaveLabel()">保存</button></div></div></form></div>';

                    index = layer.open({
                        title: "请选择",
                        type: 1,
                        area: ['800px', '400px'],
                        maxmin: true,
                        shadeClose: true,
                        content: element
                    });
                    form.render('checkbox');

                }
            });
        });

    });
    queryContactWay(itemId);
    queryInformation(itemId);






    function targetSaveLabel() {
        var texts = [];
        var str = [];
        $("input[type='checkbox']:checked").each(function () {
            texts.push($(this).attr('title'));
            str.push($(this).attr('value'));
            choose=1;
        })
        $("#target_id").val(str);
        showTarget(str);
        $("#text5").val(texts);
        layer.msg("成功", {shift: -1, time: 1000}, function () {
            layer.close(index);
        });

    }

    function showTarget(ids) {
        $.ajax({
            type: 'get',
            url: domainName + '/project-item/item/indicators/ids',
            data: "ids=" + ids,
            async: false,
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                $(data).each(function () {
                    var serial = $("#targets").closest('thead').nextAll('tbody').children().length + 1;
                    var str = '';
                    var text = getsuperior(this.site);


                    str = '<tr>' +
                        '<td class="mainTd_1 tdDorder">' + serial + '<input type="hidden" name="type" value="' + this.type + '"></td>' +
                        '<td class="mainTd_1 tdDorder" rowspan="1" colspan="1">' +
                        '<div class="field">' +
                        '<span type="text"  name="content" lay-verify="required"> ' + this.content + ' </span>' +
                        '</div>' +
                        '</td>' +
                        '</td>' +
                        '<td class="mainTd_1 tdDorder" rowspan="1" colspan="1">' +
                        '<div class="field" style="position: relative;">' +
                        '<span type="text" name="site">' + text + '</span>' +
                        '</div>' +
                        '</td>' +
                        '</tr>';

                    $("#targets").closest('thead').nextAll('tbody').append(str);
                })
            }
        })
    }

    function getItemName(id) {

        $.get(domainName + "/project-item/item/information/list?id=" + id, function (res) {
            var name = res[0]['management_unit'];
            $("#check_unit").val(name);
            $("#manage_unit").val(res[0]['entrusting_party']);
        })
    }

    getItemName(itemId);

    function add(obj) {

        if ($("#target_id").val() == "") {
            layer.msg("请选择指标");
            return;
        }

        if ($("#period").val()==''){
            layer.msg("请选择时间范围");
            return;
        }

        $('#form').bootstrapValidator();
        var bootstrapValidator = $("#form").data('bootstrapValidator');
        bootstrapValidator.validate();
        if (!bootstrapValidator.isValid()) {
            return;
        }
        $(obj).attr("disabled", true);
        var formdata = $("#form").serializeObject();
        formdata.item_id = itemId;
        formdata.edit_userid = userId;
        formdata.post_type = 1;
        $.ajax({
            type: 'post',
            url: domainName + '/project-item/item/target/auditApply/one',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(formdata),
            success: function (data) {
                var msg = "成功";
                layer.msg(msg, {shift: -1, time: 1000}, function () {
                    parent.location.reload();
                });
            }
        });
    }

</script>
</body>
</html>