<!DOCTYPE html>
<html>
<meta name="viewport"
      content="width=device-width, initial-scale=1, user-scalable=no">
<head>
    <meta charset="UTF-8">
    <title>资金使用</title>
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../layui/css/layui.css">
 <!--   <link rel="stylesheet" type="text/css" media="screen" href="../list-layout/css/projectInfo.css">-->

    <style>
        .title {
            text-align: center;
            line-height: 30px;
            color: black;
            font-weight: 600;
            background-color: #e4e4e4;
            height: 30px;
        }
    </style>

</head>

<body>


<div style="margin-top: 10px;" class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <form class="form-horizontal" onsubmit="return false" id="form">
        <fieldset>

            <p class="title">资金构成</p>
            <div style="position: relative;">
                <div class="content">

                    <table class="layui-table" id="fundSource">
                        <colgroup>
                            <col width="25%">
                            <col width="25%">
                            <col width="25%">
                            <col width="25%">
                            <col width="25%">
                        </colgroup>
                        <thead>
                        <tr>
                            <th style="text-align: center;">科目</th>
                            <th style="text-align: center;">金额</th>
                            <th style="text-align: center;">剩余</th>
                            <th colspan="2" style="text-align: center;">操作</th>
                        </tr>
                        </thead>
                        <tbody id="zijin">
                        <tr>
                            <th style="text-align: center;">合计</th>
                            <th id="zijinheji" style="text-align: center;"></th>
                            <th id="surplus" style="text-align: center;"></th>
                            <th  style="text-align: center;"></th>
                            <th  style="text-align: center;"></th>
                        </tr>
                    </table>
                </div>
            </div>
        </fieldset>
    </form>
</div>
<!-- 按钮组 -->
<!--<div class="btn-box">
    <div style="display: block;">
        <a id="useAll" class="layui-btn  layui-btn-sm" style="width:100%;">
            <i class="layui-icon layui-icon-return"></i>全&nbsp;&nbsp;&nbsp;&nbsp;部</a>
    </div>
    <div style="display: block;">
        <a href="../../list-layout/list.html" class="layui-btn  layui-btn-sm" style="width:100%;display: block;">
            <i class="layui-icon layui-icon-return"></i>返&nbsp;&nbsp;&nbsp;&nbsp;回</a>
    </div>
</div>-->
<!-- 基本信息 -->



<!--<div style="position: relative;">
    <div class="content">
        <p class="title">资金使用</p>
        <table class="layui-table" id="fundBudgetAll">
            <colgroup>
                <col width="25%">
                <col width="25%">
                <col width="25%">
                <col width="25%">
            </colgroup>-->
            <!--<thead>
                <tr>
                    <th>科目</th>
                    <th>金额</th>
                    <th>剩余</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>工本费</td>
                    <td>30（万）</td>
                    <td>10万</td>
                    <td>详情</td>
                </tr>
            </tbody>-->
 <!--       </table>
    </div>
</div>-->
</body>

<script src="../../js/constant.js"></script>
<script type="text/javascript" src="../../js/libs/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../../js/jq.js"></script>
<script type="text/javascript" src="../../js/plugin/datatables/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="../../js/plugin/datatables/dataTables.bootstrap.min.js"></script>
<script type="text/javascript" src="../../layui/layui.js"></script>
<script type="text/javascript" src="../../js/common.js"></script>
<script type="text/javascript" src="../../js/my/permission.js"></script>

<script type="text/javascript">




    layui.use(['layer'], function () {
        var layer = layui.layer;
    });

    var id = getUrlParam("id");

 /*   $("#useAll").attr("href","fundUseAll.html?id="+id);*/
    fundBudgetAll(id);
    function fundBudgetAll(id) {
         $.ajax({
            type : 'get',
            url : domainName + '/project-item/item/budget/all/'+id,
            async : false,
            success : function(data) {
                var count=0;
                var str ;
                $(data).each(function () {
                    count+=this.money;
                    str+=' <tr>' +
                        '<th style="text-align: center;">'+this.subject+'</th>' +
                        '<th style="text-align: center;">'+this.money+'</th>' +
                        ' <td style="text-align: center;" class="use">'+this.id+'</td>\n' +
                        '<td style="text-align: center;">' +
                        '<a onclick="useInfo('+this.id+');" class="layui-btn layui-btn-xs">详情</a>' +
                        '</td>' +
                        '<td style="text-align: center;">' +
                        '<a onclick="add('+this.id+');" class="layui-btn layui-btn-xs">录入</a>' +
                        '</td>' +
                        '</tr>';
                })
                      $("#zijin").append(str);
                $("#zijinheji").text(count);
            }
         });
                /*  var str1;
                var str2;
                var str3 = '';
                var count=0;
                $(data).each(function () {
                    count+=this.money;
                    //var surplus = this.money - useCount;
                    str1 = '<thead>\n' +
                        '       <tr>\n' +
                        '           <th>科目</th>\n' +
                        '           <th>预算金额(万元)</th>\n' +
                        '           <th>剩余金额(万元)</th>\n' +
                        '           <th>操作</th>\n' +
                        '       </tr>\n' +
                        '   </thead>\n' +
                        '   <tbody>\n' +
                        '       <tr>\n' +
                        '           <td>合计</td>\n' +
                        '           <td>'+count+'</td>\n' +
                        '           <td id="surplus">/</td>\n' +
                        '           <td>/</td>\n' +
                        '      </tr>';
                    str2 = '<tbody>';
                    str3 += '<tr>\n' +
                        '       <td>'+this.subject+'</td>\n' +
                        '       <td>'+this.money+'</td>\n' +
                        '       <td class="use">'+this.id+'</td>\n' +
                        '       <td>' +
                        '           <a onclick="useInfo('+this.id+');" class="layui-btn layui-btn-xs">详情</a>' +
                        '           <a onclick="add('+this.id+');" class="layui-btn layui-btn-xs">录入</a>' +
                        '       </td>\n' +
                        '    </tr>';*/

             /*   $("#fundBudgetAll").append(str1);
                $("#fundBudgetAll").append(str3);
                $("#fundBudgetAll").append(str2);
*/
    }
  var useCount = 0;
    fundBudget();
    function fundBudget() {
        var surplus = 0;
        $(".use").each(function () {
            fundBudgetUse($(this).text());
            var budget = $(this).prev().text();
            $(this).text(budget - useCount);
            surplus += $(this).text()-0;
            useCount = 0;//归零
        })
        $("#surplus").text(surplus);
    }

    function fundBudgetUse(id){
        $.ajax({
            type : 'get',
            url : domainName + '/project-item/item/fund/use/info/'+id,
            async : false,
            success : function(data) {
                $(data).each(function () {
                    useCount += this.expenditure;
                });
            }
        });
    }

    function useInfo(id){
        $(location).attr("href", "useInfo.html?id=" + id);
    }
    function add(id){
        layer.open({
            title:"资金使用录入",
            type: 2,
            area: ['350px', '350px'],
            maxmin: true,
            shadeClose: true,
            content: ['add_usefund.html?id='+id]
        });
    }
</script>

</html>