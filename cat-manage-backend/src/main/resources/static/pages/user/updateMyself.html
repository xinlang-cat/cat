<!DOCTYPE html>
<html lang="en-us" id="extr-page">
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" media="screen" href="../../css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" media="screen" href="../../layui/css/layui.css">
</head>
<body>
	<div class="col-xs-12 col-sm-12 col-md-22 col-lg-12">
		<form class="form-horizontal" onsubmit="return false" id="form" style="padding-bottom: 30px">
			<input type="hidden" id="id" name="id">
			<fieldset>
				<div class="form-group">
					<label class="col-md-2 control-label">用户名</label>
					<div class="col-md-8">
						<input class="form-control" placeholder="用户名" type="text" name="username" id="username" readonly="readonly">
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">昵称</label>
					<div class="col-md-8">
						<input class="form-control" placeholder="昵称" type="text" name="nickname" id="nickname" maxlength="50">
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">性别</label>
					<div class="col-md-8">
						<select class="form-control input-sm" name="sex" id="sex">
							<option value="1">男</option>
							<option value="0">女</option>
						</select>
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-md-2 control-label">出生时间</label>
					<div class="col-md-8">
						<input type="text" class="form-control" placeholder="出生时间" name="birthDate" id="birthDate">
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">姓名</label>
					<div class="col-md-8">
						<input class="form-control" placeholder="姓名" type="text" name="name" id="name"
							   data-bv-notempty="true"
							   data-bv-notempty-message="姓名 不能为空">
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-md-2 control-label">民族</label>
					<div class="col-md-8">
						<input class="form-control" placeholder="民族" type="text" name="nation" id="nation">
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">身份选择</label>
					<div class="col-md-8">
						<select class="form-control input-sm" name="userType" id="userType">
							<option value="PARTY_A">甲方</option>
							<option value="PARTY_B">乙方</option>
							<option value="PARTY_C">监理</option>
							<option value="PARTY_D">验收</option>
							<option value="EXPERT">专家</option>
						</select>
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">证件类型</label>
					<div class="col-md-8">
						<select class="form-control input-sm" name="idType" id="idType">
							<option value="身份证">身份证</option>
							<option value="护照">护照</option>
							<option value="其他">其他</option>
						</select>
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">证件号码</label>
					<div class="col-md-8">
						<input class="form-control" placeholder="证件号码" type="text" name="idCard" id="idCard" >
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">单位/公司代码</label>
					<div class="col-md-8">
						<input class="form-control" placeholder="单位/公司代码" type="text" name="deptCode" id="deptCode" >
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">单位/公司名称</label>
					<div class="col-md-8">
						<input class="form-control" placeholder="单位/公司名称" type="text" name="deptName" id="deptName" readonly="readonly" >
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">单位/公司级别</label>
					<div class="col-md-8">
						<input class="form-control" placeholder="单位/公司级别" type="text" name="deptType" id="deptType"  readonly="readonly">
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">邮政编码</label>
					<div class="col-md-8">
						<input type="text" class="form-control" placeholder="邮政编码" name="postcode" id="postcode">
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">职称</label>
					<div class="col-md-8">
						<input class="form-control" placeholder="单位/公司级别" type="text" name="academicTitle" id="academicTitle" >
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">政治面貌</label>
					<div class="col-md-8">
						<select class="form-control input-sm" name="politics" id="politics">
							<option value="1">共产党员</option>
							<option value="0">共青团员</option>
							<option value="0">群众</option>
						</select>
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">职务</label>
					<div class="col-md-8">
						<input class="form-control" placeholder="职务" type="text" name="job" id="job">
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">职称级别</label>
					<div class="col-md-8">
						<input class="form-control" placeholder="职称级别" type="text" name="academicTitleRank" id="academicTitleRank">
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">毕业院校</label>
					<div class="col-md-8">
						<input class="form-control" placeholder="毕业院校" type="text" name="graduatedFrom" id="graduatedFrom">
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">学位</label>
					<div class="col-md-8">
						<select class="form-control input-sm" name="degree" id="degree">
							<option value="学士">学士</option>
							<option value="硕士">硕士</option>
							<option value="博士">博士</option>
						</select>
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">学历</label>
					<div class="col-md-8">
						<select class="form-control input-sm" name="academicDiplomas" id="academicDiplomas">
							<option value="初中">初中</option>
							<option value="高中">高中</option>
							<option value="中专">中专</option>
							<option value="大专">大专</option>
							<option value="本科">本科</option>
							<option value="研究生">研究生</option>
						</select>
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">学位获得时间</label>
					<div class="col-md-8">
						<input type="text" class="form-control" placeholder="学位获得时间" name="lastYear" id="lastYear">
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">学位授予国家/地区</label>
					<div class="col-md-8">
						<input type="text" class="form-control" placeholder="学位授予国家/地区" name="degreeState" id="degreeState">
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">学位授予学校</label>
					<div class="col-md-8">
						<input type="text" class="form-control" placeholder="学位授予学校" name="degreeSchool" id="degreeSchool">
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">邮箱</label>
					<div class="col-md-8">
						<input type="text" class="form-control" placeholder="邮箱" name="email" id="email">
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">所学专业</label>
					<div class="col-md-8">
						<div class="input-group" id="major" data-status="true" data-sign="projectType">
							<input type="text" class="form-control" placeholder="技术专长及提供的服务" aria-describedby="projectType" name="major">
							<span class="input-group-addon" ><a >选择</a></span>
						</div>
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">手机号码</label>
					<div class="col-md-8">
						<input type="text" class="form-control" placeholder="手机号码" name="phone" id="phone">
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">办公电话</label>
					<div class="col-md-8">
						<input type="text" class="form-control" placeholder="办公电话" name="telephone" id="telephone">
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">现从事专业</label>
					<div class="col-md-8">
						<div class="input-group" id="nowMajor" data-status="true" data-sign="projectType">
							<input type="text" class="form-control" placeholder="技术专长及提供的服务" >
							<span class="input-group-addon"><a >选择</a></span>
						</div>
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">主要研究领域</label>
					<div class="col-md-8">
						<input class="form-control" placeholder="主要研究领域" type="text" name="mainDomain" id="mainDomain"  readonly="readonly">
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-md-2 control-label">传真</label>
					<div class="col-md-8">
						<input type="text" class="form-control" placeholder="传真" name="fax" id="fax">
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">所在地域</label>
					<div class="col-md-2">
						<select class="form-control input-sm" name="provinceCode" id="provinceCode">
						</select>
					</div>
					<div class="col-md-2">
						<select class="form-control input-sm" name="cityCode" id="cityCode">
						</select>
					</div>
					<div class="col-md-2">
						<select class="form-control input-sm" name="areaCode" id="areaCode">
						</select>
					</div>
					<div class="col-md-2">
						<select class="form-control input-sm" name="streetCode" id="streetCode">
						</select>
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">通讯地址</label>
					<div class="col-md-8">
						<input class="form-control" placeholder="通讯地址" type="text" name="address" id="address">
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">服务的产业或领域</label>
					<div class="col-md-8">
						<div class="input-group" id="domains" data-status="true" data-sign="projectType">
							<input type="text" class="form-control" placeholder="服务的产业或领域" name="domains">
							<span class="input-group-addon" ><a>选择</a></span>
						</div>
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">技术专长及提供的服务</label>
					<div class="col-md-8">
						<div class="input-group" id="skills" data-status="true" data-sign="projectType">
							<input type="text" class="form-control" placeholder="技术专长及提供的服务"name="skills">
							<span class="input-group-addon" ><a >选择</a></span>
						</div>
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">承担的科技项目</label>
					<div class="col-md-8">
						<input type="text" class="form-control" placeholder="承担的科技项目" name="projects" id="projects">
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">工作成就案例</label>
					<div class="col-md-8">
						<textarea class="layui-textarea" id="accomplishment" style="display: none">
						</textarea>
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">获得的科技成果/奖励/荣誉</label>
					<div class="col-md-8">
						<textarea class="layui-textarea" id="achievement" style="display: none">
						</textarea>
					</div>
				</div>
				<input type="hidden" class="form-control" id="projectUserId">
				<input type="hidden" class="form-control" id="identity">
				<input type="hidden" class="form-control" name="enable" value="true">
				<div class="form-actions">
					<div class="row" align="center">
						<div class="col-md-12" id="div_submit">
							<button class="btn btn-primary" type="submit" onclick="update()">
								<i class="fa fa-save"></i> 保存
							</button>
						</div>
					</div>
				</div>
			</fieldset>
		</form>
	</div>


	<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
		<form class="layui-form" onsubmit="return false" id="form3">
			<div class="layui-form-item">
				<div class="layui-inline">
					<label class="layui-form-label"></label>
					<div class="layui-input-inline">
						<input type="checkbox" lay-filter="selectAll" lay-skin="primary" title="全选"><div class="layui-unselect layui-form-checkbox" lay-skin="primary"><span>全选</span><i class="layui-icon layui-icon-ok"></i></div>
					</div>
				</div>
			</div>
			<div class="layui-form-item">
				<div class="layui-input-block" id="ckb">
					<input type="checkbox" name="permission" id="59" value="59" title="修改标签">
					<div class="layui-unselect layui-form-checkbox layui-form-checked"><span>修改标签</span><i class="layui-icon layui-icon-ok"></i></div>
				</div>
			</div>
			<div class="layui-form-item">
				<div class="layui-input-block">
					<button class="layui-btn" onclick="save()">立即提交</button>
				</div>
			</div>
		</form>
	</div>

	<script src="../../js/constant.js"></script>
	<script type="text/javascript" src="../../js/libs/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" src="../../js/jq.js"></script>
	<script type="text/javascript" src="../../js/plugin/bootstrapvalidator/bootstrapValidator.min.js"></script>
	<script type="text/javascript" src="../../js/common.js"></script>
	<script type="text/javascript" src="../../layui/layui.js"></script>
	<script type="text/javascript" src="../../js/label.js"></script>
	<script type="text/javascript">

		var layedit ,index1,index2,layer,tree,util,laydate,form;

		layui.use(['tree','layedit','upload','layer','util', 'laydate'], function(){
			layedit = layui.layedit;
			layer  = layui.layer;
			laydate = layui.laydate;
			tree = layui.tree;
			util = layui.util;
			form = layui.form;

			laydate.render({
				elem: '#birthDate'
			});

			layedit.set({
				uploadImage: {
					url: domainName + '/zuul/api-f/files/layui?access_token='+localStorage.getItem("access_token"),
					type: 'post'
				}
			});

			index1 = layedit.build('accomplishment');
			index2 = layedit.build('achievement');
		});

		initData();

		function initData(){
			$.ajax({
				type : 'get',
				url : domainName + '/api-u/users/current',
				async : false,
				success : function(data) {
					setValue(data);
					$.ajax({
						type : 'get',
						url : domainName + '/project-user/user-anon/'+data.id,
						async : false,
						success : function(data) {
							if(jQuery.isEmptyObject(data)){
								$("#div_submit").empty();
								var str = '<button class="btn btn-primary" type="submit" onclick="update(0)">\n' +
										'\t\t\t\t\t\t\t\t<i class="fa fa-save"></i> 保存\n' +
										'\t\t\t\t\t\t\t</button>';
								$("#div_submit").append(str);
							}else{
								var str = '<button class="btn btn-primary" type="submit" onclick="update(1)">\n' +
										'\t\t\t\t\t\t\t\t<i class="fa fa-save"></i> 保存\n' +
										'\t\t\t\t\t\t\t</button>';
								$("#div_submit").append(str);
								$("#projectUserId").val(data.id);
								$("#sex").val(data.sex);
								$("#name").val(data.name);
								$("#birthDate").val(data.birthDate);
								$("#nation").val(data.nation);
								$("#idType").val(data.idType);
								$("#idCard").val(data.idCard);
								$("#stateCode").val(data.stateCode);
								$("#provinceCode").val(data.provinceCode);
								$("#cityCode").val(data.cityCode);
								$("#areaCode").val(data.areaCode);
								$("#streetCode").val(data.streetCode);
								$("#deptCode").val(data.deptCode);
								$("#deptName").val(data.deptName);
								$("#deptType").val(data.deptType);
								$("#academicTitle").val(data.academicTitle);
								$("#politics").val(data.politics);
								$("#job").val(data.job);
								$("#academicTitleRank").val(data.academicTitleRank);
								$("#graduatedFrom").val(data.graduatedFrom);
								$("#address").val(data.address);
								$("#degree").val(data.degree);
								$("#academicDiplomas").val(data.academicDiplomas);
								$("#lastYear").val(data.lastYear);
								$("#degreeState").val(data.degreeState);
								$("#degreeSchool").val(data.degreeSchool);
								$("#email").val(data.email);
								$("#major").val(data.major);
								$("#telephone").val(data.telephone);
								$("#nowMajor").val(data.nowMajor);
								$("#phone").val(data.phone);
								$("#mainDomain").val(data.mainDomain);
								$("#fax").val(data.fax);
								$("#postcode").val(data.postcode);
								$("#projects").val(data.projects);
								$("#achievement").val(data.achievement);
								$("#accomplishment").val(data.accomplishment);
								$("#userType").val(data.userType);
							}
						}
					});
				}
			});
		}

		function update(status) {
			$('#form').bootstrapValidator();
			var bootstrapValidator = $("#form").data('bootstrapValidator');
			bootstrapValidator.validate();
			if(!bootstrapValidator.isValid()){
			   return;
			}
			var formdata = $("#form").serializeObject();
			$.ajax({
				type : 'put',
				url : domainName + '/api-u/users/me',
				contentType: "application/json; charset=utf-8",
				data : JSON.stringify(formdata),
				success : function(data) {
					if(status == 1){
						formdata.accomplishment = layedit.getContent(index1);
						formdata.achievement = layedit.getContent(index2);
						formdata.uerId = $("#projectUserId").val();
						$.ajax({
							type : 'put',
							url : domainName + '/project-user/user',
							contentType: "application/json; charset=utf-8",
							data : JSON.stringify(formdata),
							success : function(data) {

							}
						});
					}else {
						formdata.accomplishment = layedit.getContent(index1);
						formdata.achievement = layedit.getContent(index2);
						formdata.id = null;
						formdata.uerId = $("#projectUserId").val();
						formdata.userType =
						$.ajax({
							type : 'post',
							url : domainName + '/project-user/user',
							contentType: "application/json; charset=utf-8",
							data : JSON.stringify(formdata),
							success : function(data) {
								$.ajax({
									type : 'post',
									url : domainName + '/api-c/user',
									contentType: "application/json; charset=utf-8",
									data : JSON.stringify(formdata),
									success : function(data) {
									}
								});
							}
						});

					}
					layer.msg("成功", {shift: -1, time: 1000}, function(){
						parent.$(".admin-header-user span").text($("#nickname").val());
						refresh_token(); //刷新当前登录用户缓存
						deleteCurrentTab();
					});
				}
			});
		}

		$("#deptCode").change(function () {
			var deptCode =$.trim( $(this).val());
			$.ajax({
				type : 'get',
				url : domainName + '/api-c/company/'+deptCode,
				success : function(data) {
					if(jQuery.isEmptyObject(data)){
						layer.open({
							closeBtn: 0
							,title:"还没添加公司信息呢"
							,btn: ['返回首页', '去完善公司信息']
							,btn1: function(index, layero){
								deleteCurrentTab();
							}
							,btn2: function(index, layero){
								location.href=domainName + '/api-b/pages/company/addCompany.html';
							}
						})
					}else{
						$("#deptCode").val(data.deptCode);
						$("#deptName").val(data.signName);
						$("#deptType").val(data.type);
						$("#identity").val(data.identity);
					}
				}
			});
		})

		function setValue(data) {
			$("#id").val(data.id);
			$("#username").val(data.username);
			$("#nickname").val(data.nickname);
			$("#sex").val(data.sex);
		}

	</script>
</body>
</html>