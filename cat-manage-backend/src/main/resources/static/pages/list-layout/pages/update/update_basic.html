<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>基本信息</title>
    <link rel="stylesheet" type="text/css" media="screen" href="../../../../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../../../css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../../../layui/css/layui.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/details.css">
</head>
<style>
    .layui-table thead tr {
        background: #dbe7f3;
        text-align: center;
    }
    .layui-table th {
        text-align: center;
        font-weight: 400;
    }
   .layui-btn {
        background-color: #a0a8c5;
    }    /*
    .form-actions {
        margin-top: 100px;
    }*/
    .layui-input:focus,.layui-textarea:focus{
        border-color: #66afe9!important;
        box-shadow: rgba(102,175,233,0.9) 0px 0px 8px;
    }
   /* .content{
        width: 90%;
        margin: 0 auto;
        position: relative;
    }*/
</style>
</head>

<body>
<div class="content">
    <!--基本信息-->
    <div class="module">
        <form class="layui-form" id="form1">
            <table lay-even lay-skin="nob" class="layui-table">
                <colgroup>
                    <col width="20%">
                    <col width="80%">
                </colgroup>
                <thead>
                <th class="header" colspan="4">基本信息</th>
                </thead>
                <tbody>
                <input type="hidden" id="id" name="id" value=""/>
                <tr>
                    <td>合同编号：</td>
                    <td>
                    <input  class="form-control" lay-verify="required" placeholder="合同编号" type="text"
                               id="contract_no" name="contract_no">

                    </td>
                </tr>
                <tr>
                    <td>计划类别：</td>
                    <td>
                        <select class="form-control input-sm" lay-verify="required" lay-ignore id="category" name="category">
                            <option value="">请选择</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>项目名称：</td>
                    <td>
                        <input class="form-control" lay-verify="required" placeholder="合同编号" type="text"
                               id="item_name" name="item_name">
                    </td>
                </tr>
                <tr>
                    <td>委托单位：</td>
                    <td>
                        <select class="form-control input-sm" lay-verify="required" lay-ignore id="consignor" name="consignor">
                            <option value="">请选择</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>承担单位：</td>
                    <td>
                        <select class="form-control input-sm" lay-verify="required" lay-ignore id="undertaker" name="undertaker">
                            <option value="">请选择</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>管理单位：</td>
                    <td>
                        <select class="form-control input-sm" lay-verify="required" lay-ignore id="administrator" name="administrator">
                            <option value="">请选择</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>下达文号：</td>
                    <td>
                        <input class="form-control" lay-verify="required" placeholder="下达文号" type="text"
                               id="item_number" name="item_number">
                    </td>
                </tr>
                <tr>
                    <td>开始时间：</td>
                    <td>
                        <input class="form-control date" lay-verify="required" placeholder="开始时间" type="text"
                               id="start_date" name="start_date">
                    </td>
                </tr>
                <tr>
                    <td>结束时间：</td>
                    <td>
                        <input class="form-control date" lay-verify="required" placeholder="结束时间" type="text"
                               id="end_date" name="end_date">
                    </td>
                </tr>
                <tr>
                    <td>总体目标：</td>
                    <td>
                                <textarea placeholder="总体目标" class="layui-textarea form-control" lay-verify="required"
                                          id="outline" name="outline"></textarea>
                    </td>
                </tr>
                </tbody>
            </table>

            <div class="form-actions">
                <div class="row" align="center">
                    <div class="col-md-12">
                        <button class="btn btn-primary" onclick="retuen_btn();">返回</button>
                        <button class="btn btn-primary" type="submit" onclick="update();">
                            <i class="fa fa-save"></i> 保存
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
</body>
<script src="../../../../js/constant.js"></script>
<script type="text/javascript" src="../../../../js/libs/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../../../../js/jq.js"></script>
<script type="text/javascript" src="../../../../js/plugin/datatables/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="../../../../js/plugin/datatables/dataTables.bootstrap.min.js"></script>
<script type="text/javascript" src="../../../../layui/layui.js"></script>
<script type="text/javascript" src="../../../../js/common.js"></script>
<script type="text/javascript" src="../../../../js/my/permission.js"></script>
<script type="text/javascript">
    var id =getUrlParam("id");
    $("#id").val(id);
    layui.use(['layer', 'form', 'laydate', 'upload'], function () {
        var layer = layui.layer
            , upload = layui.upload
            , form = layui.form
            , laydate = layui.laydate;
        lay('.date').each(function () {
            laydate.render({
                elem: this
                , showBottom: false
                , trigger: 'click'
            });
        });
        //监听提交
        form.on('submit(formDemo)', function (data) {
            layer.msg(JSON.stringify(data.field));
            return false;
        });
    });
    /*初始化数据*/
    initplanCategorySelect('PLAN_CATEGOR');
    initCompanySelect();
    initData();

    /*回填*/
 function initData() {
     $.ajax({
         type: 'get',
         url: domainName + '/project-item/item/basic/list',
         data: "id=" + id,
         async: false,
         contentType: "application/json; charset=utf-8",
         success: function (data) {
             var d = data[0];
             $("#contract_no").val(d.contract_no);
             $("#category").val(d.category);
             $("#item_name").val(d.item_name);
             $("#consignor").val(d.consignor);
             $("#undertaker").val(d.undertaker);
             $("#administrator").val(d.administrator);
             $("#item_number").val(d.item_number);
             $("#start_date").val(d.start_date.substring(0,10));
             $("#end_date").val(d.end_date.substring(0,10));
             $("#outline").val(d.outline);
         }
     })
 }
    function initCompanySelect() {
        $.ajax({
            type: 'get',
            url: domainName + '/api-c/company/all',
            async: false,
            success: function (data) {
                $(data).each(function () {
                    var code = this.deptCode,
                        name = this.signName;
                    $('#consignor').append('<option value=' + code + '>' + name + '</option>');
                    $('#undertaker').append('<option value=' + code + '>' + name + '</option>');
                    $('#administrator').append('<option value=' + code + '>' + name + '</option>');
                });
            }
        })
    }
    function initplanCategorySelect(sign){
        $.ajax({
            type : 'get',
            url: domainName + '/api-label/label/tree/' + sign,
            async : false,
            success : function(data) {
                var ds = data[0].child;
                $(ds).each(function () {
                    $("#category").append('<option value=' + this.sign + '>' + this.content + '</option>');
                });
            }
        });
    }
    function update() {
        var formdata = $("#form1").serializeObject();
        $.ajax({
            type: 'put',
            url: domainName + '/project-item/item/basic',
            contentType: "application/json; charset=utf-8",
            async: false,
            data: JSON.stringify(formdata),
            success: function (data) {
                layer.msg("成功", {shift: -1, time: 3000}, function () {
                });
                var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
                parent.location.reload();//刷新父页面，注意一定要在关闭当前iframe层之前执行刷新
                parent.layer.close(index); //再执行关闭
            }
        });
    }

    function retuen_btn() {
        var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
        parent.location.reload();//刷新父页面，注意一定要在关闭当前iframe层之前执行刷新
        parent.layer.close(index); //再执行关闭
    }
</script>
</html>