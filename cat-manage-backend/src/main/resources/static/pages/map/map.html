<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Insert title here</title>
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" href="../../layui/css/layui.css" media="all"/>
    <link rel="stylesheet" href="http://api.map.baidu.com/library/SearchInfoWindow/1.4/src/SearchInfoWindow_min.css"/>
    <style>
        body, html {
            width: 100%;
            height: 100%;
            overflow: hidden;
            margin: 0;
            font-family: "微软雅黑";
        }

        #allmap {

            height: 100%;
            overflow: hidden;
            margin: 0;
            font-family: "微软雅黑";
            float: left;
        }

        #data_manipulation {
            float: right;
        }
    </style>
</head>
<body>

<div id="allmap" class="col-md-10"></div>
<div id="data_manipulation" class="col-md-2">
    <div class="form-actions">
        <div class="row">
            <div>
                <div><img src="img/green.png">广西重点研发计划</div>
                <!--                <button class="btn btn-primary" onclick="location.href='userList.html'">返回</button>-->
                <!--                <button class="btn btn-primary" type="submit" onclick="add()">-->
                <!--                    <i class="fa fa-save"></i> 保存-->
                <!--                </button>-->

            </div>
        </div>
    </div>
</div>
</body>

<script src="../../js/constant.js"></script>
<script type="text/javascript" src="../../js/libs/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../../js/jq.js"></script>
<script type="text/javascript" src="../../layui/layui.js"></script>
<script type="text/javascript" src="../../js/plugin/datatables/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="../../js/plugin/datatables/dataTables.bootstrap.min.js"></script>
<script type="text/javascript" src="../../js/my/permission.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=4ZQc5ZktLFiK8tDzpBf7nDNHT7TcU6is"></script>
<script type="text/javascript"
        src="http://api.map.baidu.com/library/TextIconOverlay/1.2/src/TextIconOverlay_min.js"></script>
<script type="text/javascript"
        src="http://api.map.baidu.com/library/MarkerClusterer/1.2/src/MarkerClusterer_min.js"></script>
<!--加载鼠标绘制工具-->
<script type="text/javascript"
        src="http://api.map.baidu.com/library/DrawingManager/1.4/src/DrawingManager_min.js"></script>
<link rel="stylesheet" href="http://api.map.baidu.com/library/DrawingManager/1.4/src/DrawingManager_min.css"/>
<!--加载检索信息窗口-->
<script type="text/javascript"
        src="http://api.map.baidu.com/library/SearchInfoWindow/1.4/src/SearchInfoWindow_min.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/library/GeoUtils/1.2/src/GeoUtils_min.js"></script>
<script type="text/javascript"
        src="http://api.map.baidu.com/library/TextIconOverlay/1.2/src/TextIconOverlay_min.js"></script>
<script type="text/javascript"
        src="http://api.map.baidu.com/library/MarkerClusterer/1.2/src/MarkerClusterer_min.js"></script>
<script type="text/javascript">
    var pers = checkPermission();
    //百度地图API功能
    var map = new BMap.Map("allmap", {}); // 创建Map实例
    var point = new BMap.Point(108.374316, 22.820475);
    map.centerAndZoom(point, 11); // 初始化地图,设置中心点坐标和地图级别
    map.enableScrollWheelZoom(true); //开启鼠标滚轮缩放
    var top_left_control = new BMap.ScaleControl({anchor: BMAP_ANCHOR_TOP_LEFT});// 左上角，添加比例尺
    map.addControl(top_left_control);

    $(function () {
        initDimensioning();
    });
    //自定义图标
    var cyanIcon = new BMap.Icon("img/cyan.png", new BMap.Size(19, 25));
    var blueIcon = new BMap.Icon("img/blue.png", new BMap.Size(19, 25));
    var greenIcon = new BMap.Icon("img/green.png", new BMap.Size(19, 25));
    var orangeIcon = new BMap.Icon("img/orange.png", new BMap.Size(19, 25));
    var redIcon = new BMap.Icon("img/red.png", new BMap.Size(19, 25));
    var violetIcon = new BMap.Icon("img/violet.png", new BMap.Size(19, 25));
    var yellowIcon = new BMap.Icon("img/yellow.png", new BMap.Size(19, 25));

    //项目列表设置标注点
    function initDimensioning() {
        $.ajax({
            url: domainName + "/project-item/item/information/list",
            type: "get",
            contentType: "application/json; charset=utf-8",
            async: false,
            success: function (obj) {
                for (var i = 0; i < obj.length; i++) {
                    var status = '';
                    if (obj[i]['status'] == 0) {
                        status = "就绪";
                    } else if (obj[i]['status'] == 1) {
                        status = "进行中";
                    } else if (obj[i]['status'] == 2) {
                        status = "结题中";
                    } else if (obj[i]['status'] == 3) {
                        status = "已结题";
                    } else {
                        status = "废弃";
                    }
                    var content = "";
                    content += '<div><span style="font-size: 14px;font-weight: bold;margin-right: 15px;">项目承担单位:</span><span>' + obj[i]['responsible_unit'] + '</span></div>';
                    content += '<div><span style="font-size: 14px;font-weight: bold;margin-right: 15px;">项目监理单位:</span><span>' + obj[i]['management_unit'] + '</span></div>';
                    content += '<div><span style="font-size: 14px;font-weight: bold;margin-right: 15px;">项目起止时间:</span><span>' + formatDate4(obj[i]['start_date']) + '---' + formatDate4(obj[i]['end_date']) + '</span></div>';
                    content += '<div><span style="font-size: 14px;font-weight: bold;margin-right: 15px;">项目起止时间:</span><span>' + status +'</span></div>';
                    content += '<button class="btn btn-primary" style="margin: 10px 20px 0 0;" onclick="showStage(' + obj[i]['id'] + ')">阶段总结</button>';
                    content += '<button class="btn btn-primary" style="margin: 10px 20px 0 0;" onclick="showAudit(' + obj[i]['id'] + ')">查定报告</button>';
                    content += '<button class="btn btn-primary" style="margin: 10px 20px 0 0;" onclick="showSkill(' + obj[i]['id'] + ')">技术总结</button>';
                    content += '<button class="btn btn-primary" style="margin: 10px 20px 0 0;" onclick="showWork(' + obj[i]['id'] + ')">工作总结</button>';
                    content += '<button class="btn btn-primary" style="margin: 10px 20px 0 0;" onclick="showTarget(' + obj[i]['id'] + ')">项目指标</button>';
                    content += '<button class="btn btn-primary" style="margin: 10px 20px 0 0;" onclick="showFund(' + obj[i]['id'] + ')">经费使用</button>';
                    var point = new BMap.Point(obj[i]['lat'], obj[i]['lng']);
                    var marker = new BMap.Marker(point, {icon: greenIcon});
                    map.addOverlay(marker);
                    var opts = {
                        width: 500,
                        height: 200,
                        title: obj[i]['name'],
                        enableMessage: false
                    };
                    marker.addEventListener("click", function (e) {
                        var p = e.target;
                        var point = new BMap.Point(p.getPosition().lng, p.getPosition().lat);
                        var infoWindow = new BMap.InfoWindow(content, opts); // 创建信息窗口对象
                        map.openInfoWindow(infoWindow, point); //开启信息窗口
                    });
                }
            }
        });
    }


    layui.use(['layer'], function () {
        var layer = layui.layer;
    });

    var w = $(window).width() - 30;

    function showAudit(itemId) {
        layer.open({
            title: "查定报告",
            type: 2,
            area: [w + 'px', window.screen.height - 310 + 'px'],
            maxmin: true,
            shadeClose: true,
            content: ['../auditApply/checkedApplyList.html?item_id=' + itemId]

        });
    }

    function showSkill(itemId) {
        layer.open({
            title: "技术总结",
            type: 2,
            area: [w + 'px', window.screen.height - 310 + 'px'],
            maxmin: true,
            shadeClose: true,
            content: ['../summary/generateSkillReport.html?itemId=' + itemId]
        });
    }

    function showWork(itemId) {
        layer.open({
            title: "工作总结",
            type: 2,
            area: [w + 'px', window.screen.height - 310 + 'px'],
            maxmin: true,
            shadeClose: true,
            content: ['../summary/generateWorkReport.html?itemId=' + itemId]

        });
    }

    function showTarget(itemId) {
        layer.open({
            title: "项目指标",
            type: 2,
            area: [w + 'px', window.screen.height - 310 + 'px'],
            maxmin: true,
            shadeClose: true,
            content: ['../indicator/readIndicatorList.html?itemId=' + itemId]

        });
    }

    function showStage(itemId) {
        layer.open({
            title: "阶段总结",
            type: 2,
            area: [w + 'px', window.screen.height - 310 + 'px'],
            maxmin: true,
            shadeClose: true,
            content: ['../list-layout/pages/stage-summary/stageSummaryList.html?item_id=' + itemId]

        });
    }

    function showFund(itemId) {
        layer.open({
            title: "经费使用",
            type: 2,
            area: [w + 'px', window.screen.height - 310 + 'px'],
            maxmin: true,
            shadeClose: true,
            content: ['../list-layout/pages/fundUse/readFundBudget.html?id=' + itemId]
        });
    }


</script>
</html>