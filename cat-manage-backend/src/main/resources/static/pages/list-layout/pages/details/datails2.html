<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>基本信息</title>
    <link rel="stylesheet" type="text/css" media="screen" href="../../../../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../../../layui/css/layui.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../css/details.css">
    <style>
        .layui-table thead tr {
            background: #dbe7f3;
            text-align: center;
        }

        .layui-table th {
            text-align: center;
            font-weight: 400;
        }

        .form-control {
            /*    width: 80%; */
        }

        .layui-btn {
            background-color: #a0a8c5;
        }
    </style>
</head>

<body>
<div class="content">
    <!--基本信息-->
    <div class="module">
        <form class="layui-form" id="form1">
            <table lay-even lay-skin="nob" class="layui-table">
                <colgroup>
                    <col width="10%">
                    <col width="90%">
                </colgroup>
                <thead>
                <th class="header" colspan="4">基本信息</th>
                </thead>
                <tbody>
                <tr>
                    <td>合同编号：</td>
                    <td>
                        <input class="form-control" lay-verify="required" placeholder="合同编号" type="text"
                               id="contract_no" name="contract_no">
                    </td>
                </tr>
                <tr>
                    <td>计划类别：</td>
                    <td>
                        <select class="form-control input-sm" lay-verify="required" lay-ignore id="category"
                                name="category">
                            <option value="">请选择</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>项目名称：</td>
                    <td>
                        <input class="form-control" lay-verify="required" placeholder="合同编号" type="text"
                               id="item_name" name="item_name">
                    </td>
                </tr>
                <tr>
                    <td>委托单位：</td>
                    <td>
                        <select class="form-control input-sm" lay-verify="required" lay-ignore id="consignor"
                                name="consignor">
                            <option value="">请选择</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>承担单位：</td>
                    <td>
                        <select class="form-control input-sm" lay-verify="required" lay-ignore id="undertaker"
                                name="undertaker">
                            <option value="">请选择</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>管理单位：</td>
                    <td>
                        <select class="form-control input-sm" lay-verify="required" lay-ignore id="administrator"
                                name="administrator">
                            <option value="">请选择</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>下达文号：</td>
                    <td>
                        <input class="form-control" lay-verify="required" placeholder="下达文号" type="text"
                               id="item_number" name="item_number">
                    </td>
                </tr>
                <tr>
                    <td>开始时间：</td>
                    <td>
                        <input class="form-control date" lay-verify="required" placeholder="开始时间" type="text"
                               id="start_date" name="start_date">
                    </td>
                </tr>
                <tr>
                    <td>结束时间：</td>
                    <td>
                        <input class="form-control date" lay-verify="required" placeholder="结束时间" type="text"
                               id="end_date" name="end_date">
                    </td>
                </tr>
                <tr>
                    <td>总体目标：</td>
                    <td>
                                <textarea placeholder="总体目标" class="layui-textarea form-control" lay-verify="required"
                                          id="outline" name="outline"></textarea>
                    </td>
                </tr>
                </tbody>
            </table>
            <!--提交按钮-->
            <button class="layui-btn" lay-submit lay-filter="sub1" id="sub1">提交</button>
        </form>
    </div>
    <!--主要研究内容-->
    <div class="module">
        <form class="layui-form" id="form2">
            <div class="layui-btn-group btn-group">
                <button type="button" class="layui-btn layui-btn-sm" onclick="add_row(this);">
                    <i class="layui-icon">&#xe654;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm" onclick="del_row(this);">
                    <i class="layui-icon">&#xe640;</i>
                </button>
            </div>
            <table lay-even lay-skin="nob" class="layui-table">
                <colgroup>
                    <col width="10%">
                    <col width="90%">
                </colgroup>
                <thead>
                <th class="header" colspan="4">主要研究内容</th>
                </thead>
                <tbody id="mian-content">
                <tr>
                    <td><input type="hidden" name="item_id"></td>
                    <td>
                        <input class="form-control" lay-verify="required" placeholder="标题" type="text"
                               name="title">
                        <textarea placeholder="内容" class="layui-textarea form-control" lay-verify="required"
                                  name="content"></textarea>
                    </td>
                </tr>
                </tbody>
            </table>
            <!--提交按钮-->
            <button class="layui-btn" lay-submit lay-filter="sub2" id="sub2">提交</button>
        </form>
    </div>
    <!--考核指标-->
    <div class="module">
        <div class="layui-btn-group btn-group">
            <button type="button" class="layui-btn layui-btn-sm" onclick="option_target();">
                <i class="layui-icon">&#xe654;</i>
            </button>
            <button type="button" class="layui-btn layui-btn-sm" onclick="delete_target();">
                <i class="layui-icon">&#xe640;</i>
            </button>
        </div>
        <table lay-even lay-skin="nob" class="layui-table">
            <colgroup>
                <col width="40%">
                <col width="20%">
                <col width="20%">
            </colgroup>
            <thead>
            <th class="header" colspan="4">考核指标</th>
            </thead>

        </table>
    </div>
    <!--技术指标-->
    <form class="layui-form" id="form3">
        <div class="module target">
            <div class="layui-btn-group btn-group">
                <button type="button" class="layui-btn layui-btn-sm" onclick="add_row(this);">
                    <i class="layui-icon">&#xe654;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm" onclick="del_row(this);">
                    <i class="layui-icon">&#xe640;</i>
                </button>
            </div>
            <table lay-even lay-skin="nob" class="layui-table">
                <colgroup>
                    <col width="30%">
                    <col width="10%">
                    <col width="20%">
                    <col width="20%">
                    <col width="20%">
                </colgroup>
                <thead>
                <th class="header" colspan="5">技术指标</th>
                <tr>
                    <td>内容</td>
                    <td>数量</td>
                    <td>时间</td>
                    <td>地点</td>
                    <td>人员</td>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td><input type="hidden" name="item_id">
                        <input type="hidden" name="type" value="jishu">
                        <input type="hidden" name="status" value="0">
                        <select class="form-control input-sm" lay-verify="required" lay-ignore name="target">
                            <option value=''>请选择</option>
                        </select>
                        <!--<input class="form-control" lay-verify="required"
                               placeholder="指标内容" type="text"
                               name="target"></td>-->
                    <td><input class="form-control" lay-verify="required" placeholder="数量" type="text"
                               name="count"></td>
                    <td><input class="form-control date" lay-verify="required" placeholder="开始时间" type="text"
                               name="start_date">
                        <input class="form-control date" lay-verify="required" placeholder="结束时间" type="text"
                               name="end_date"></td>
                    <td>
                        <select class="form-control input-sm site" lay-verify="required" lay-ignore>
                            <option value=''>请选择</option>
                        </select>
                        <input type="hidden" name="district">
                        <button type="button" class="layui-btn layui-btn-xs" onclick="refresh(this);"
                                style="position: absolute;right: 20px;top: 50%;margin-top:-11px;background-color: #e1e1e1;">
                            <i class="layui-icon">&#xe669;</i>
                        </button>
                    </td>
                    <td><input class="form-control " lay-verify="required" placeholder="人员" type="text"></td>
                </tr>
                </tbody>
            </table>
        </div>
        <!--经济指标-->
        <div class="module target">
            <div class="layui-btn-group btn-group">
                <button type="button" class="layui-btn layui-btn-sm" onclick="add_row(this);">
                    <i class="layui-icon">&#xe654;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm" onclick="del_row(this);">
                    <i class="layui-icon">&#xe640;</i>
                </button>
            </div>
            <table lay-even lay-skin="nob" class="layui-table">
                <colgroup>
                    <col width="30%">
                    <col width="10%">
                    <col width="20%">
                    <col width="20%">
                    <col width="20%">
                </colgroup>
                <thead>
                <th class="header" colspan="5">经济指标</th>
                <tr>
                    <td>内容</td>
                    <td>数量</td>
                    <td>时间</td>
                    <td>地点</td>
                    <td>人员</td>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td><input type="hidden" name="item_id">
                        <input type="hidden" name="type" value="jingji">
                        <input type="hidden" name="status" value="0">
                        <select class="form-control input-sm" lay-verify="required" lay-ignore name="target">
                            <option value=''>请选择</option>
                        </select>
                    <td><input class="form-control" lay-verify="required" placeholder="数量" type="text"
                               name="count"></td>
                    <td><input class="form-control date" lay-verify="required" placeholder="开始时间" type="text"
                               name="start_date">
                        <input class="form-control date" lay-verify="required" placeholder="结束时间" type="text"
                               name="end_date"></td>
                    <td><select class="form-control input-sm site" lay-verify="required" lay-ignore>
                        <option value=''>请选择</option>
                    </select>
                        <input type="hidden" name="district">
                        <button type="button" class="layui-btn layui-btn-xs" onclick="refresh(this);"
                                style="position: absolute;right: 20px;top: 50%;margin-top:-11px;background-color: #e1e1e1;">
                            <i class="layui-icon">&#xe669;</i>
                        </button>
                    </td>
                    <td><input class="form-control " lay-verify="required" placeholder="人员" type="text"></td>
                </tr>
                </tbody>
            </table>
        </div>
        <div id="forma"></div>
        <button class="layui-btn" lay-submit lay-filter="sub3" id="sub3">提交</button>
    </form>
    <!--其他指标-->
    <form class="layui-form" id="form4">
        <div class="module target">
            <div class="layui-btn-group btn-group">
                <button type="button" class="layui-btn layui-btn-sm" onclick="add_row(this);">
                    <i class="layui-icon">&#xe654;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm" onclick="del_row(this);">
                    <i class="layui-icon">&#xe640;</i>
                </button>
            </div>
            <table lay-even lay-skin="nob" class="layui-table">
                <colgroup>
                    <col width="40%">
                    <col width="20%">
                    <col width="20%">
                    <col width="20%">
                </colgroup>
                <thead>
                <th class="header" colspan="4">其他指标</th>
                <tr>
                    <td>内容</td>
                    <td>时间</td>
                    <td>地点</td>
                    <td>人员</td>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td><input type="hidden" name="item_id">
                        <input type="hidden" name="type" value="qita">
                        <input type="hidden" name="status" value="0">
                        <input class="form-control" lay-verify="required"
                               placeholder="指标内容" type="text"
                               name="content"></td>
                    <td><input class="form-control date" lay-verify="required" placeholder="开始时间" type="text"
                               name="start_date">
                        <input class="form-control date" lay-verify="required" placeholder="结束时间" type="text"
                               name="end_date"></td>
                    <td><select class="form-control input-sm site" lay-verify="required" lay-ignore>
                        <option value=''>请选择</option>
                    </select>
                        <input type="hidden" name="district">
                        <button type="button" class="layui-btn layui-btn-xs" onclick="refresh(this);"
                                style="position: absolute;right: 20px;top: 50%;margin-top:-11px;background-color: #e1e1e1;">
                            <i class="layui-icon">&#xe669;</i>
                        </button>
                    </td>
                    <td><input class="form-control " lay-verify="required" placeholder="人员" type="text"></td>
                </tr>
                </tbody>
            </table>
        </div>
        <button class="layui-btn" lay-submit lay-filter="sub4" id="sub4">提交</button>
    </form>
    <!--项目成员-->
    <div class="module">
        <form class="layui-form" id="form5">
            <div class="layui-btn-group btn-group">
                <button type="button" class="layui-btn layui-btn-sm" onclick="add_row(this);">
                    <i class="layui-icon">&#xe654;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm" onclick="del_row(this);">
                    <i class="layui-icon">&#xe640;</i>
                </button>
            </div>
            <table lay-even lay-skin="nob" class="layui-table">
                <colgroup>
                    <col width="10%">
                    <col width="8%">
                    <col width="8%">
                    <col width="20%">
                    <col width="10%">
                    <col width="10%">
                    <col width="14%">
                    <col width="20%">
                </colgroup>
                <thead>
                <th class="header" colspan="9">项目组人员信息</th>
                <tr>
                    <th>姓名</th>
                    <th>性别</th>
                    <th>年龄</th>
                    <th>证件类型/证件号码</th>
                    <th>职称</th>
                    <th>从事专业</th>
                    <th>工作单位</th>
                    <th>研究开发中的责任分工</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>
                        <input type="hidden" name="item_id">
                        <select class="form-control input-sm" lay-verify="required" lay-ignore name="user_id">
                            <option value="">请选择</option>
                        </select></td>
                    <td><input class="form-control" placeholder="性别" type="text" readonly></td>
                    <td><input class="form-control" placeholder="年龄" type="text" readonly></td>
                    <td><input class="form-control" placeholder="证件类型/证件号码" type="text" readonly></td>
                    <td><input class="form-control" placeholder="职称" type="text" readonly></td>
                    <td><input class="form-control" placeholder="从事专业" type="text" readonly></td>
                    <td><input class="form-control" placeholder="工作单位" type="text" readonly></td>
                    <td>
                        <input class="form-control targetIds" placeholder="负责或参与的指标" type="text" readonly>
                        <input type="hidden" name="targetIds">
                    </td>
                </tr>
                </tbody>
            </table>
            <button class="layui-btn" lay-submit lay-filter="sub5" id="sub5">提交</button>
        </form>
    </div>
    <!--科技经费用途预算-->
    <div class="module">
        <form class="layui-form" id="form7">
            <div class="layui-btn-group btn-group">
                <button type="button" class="layui-btn layui-btn-sm" onclick="add_row(this);">
                    <i class="layui-icon">&#xe654;</i>
                </button>
                <button type="button" class="layui-btn layui-btn-sm" onclick="del_row(this);">
                    <i class="layui-icon">&#xe640;</i>
                </button>
            </div>
            <table lay-even class="layui-table" id="basis">
                <colgroup>
                    <col width="20%">
                    <col width="10%">
                    <col width="55%">
                    <col width="10%">
                </colgroup>
                <thead>
                <th class="header" colspan="4">科技经费用途预算(桂财教函[2010]28号)</th>
                <tr>
                    <td>科目</td>
                    <td>金额(万元)</td>
                    <td>开支内容</td>
                    <td>使用状况</td>
                </tr>
                <tr>
                    <td>合计</td>
                    <td>70</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>(一)直接使用</td>
                    <td>70</td>
                    <td></td>
                    <td></td>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td><input class="form-control" lay-verify="required" placeholder="科目" type="text"
                               name="end_date"></td>
                    <td><input class="form-control" lay-verify="required" placeholder="金额" type="text"
                               name="end_date"></td>
                    <td><input class="form-control" lay-verify="required" placeholder="开支内容" type="text"
                               name="end_date"></td>
                    <td class="btn_center">
                        <button type="button"
                                class="layui-btn layui-btn-primary layui-btn-sm ">详情
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
            <button class="layui-btn" lay-submit lay-filter="sub1">提交</button>
        </form>
    </div>
    <!--签订合同各方-->
    <div class="module">
        <form class="layui-form" id="form8">
            <table lay-even class="layui-table">
                <colgroup>
                    <col width="15%">
                    <col width="40%">
                    <col width="40%">
                </colgroup>
                <thead>
                <th class="header" colspan="3">签订合同各方</th>
                </thead>
                <tbody>
                <tr>
                    <td rowspan="7">乙方</td>
                    <td>项目负责人</td>
                    <td><input style="border: none;" class="form-control" placeholder="项目负责人" type="text"
                               name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="项目负责人 不能为空"></td>
                </tr>
                <tr>
                    <td>（单位）</td>
                    <td><input style="border: none;" class="form-control" placeholder="（单位）" type="text"
                               name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="（单位） 不能为空"></td>
                </tr>
                <tr>
                    <td>组织机构代码/统一社会信用代码</td>
                    <td><input style="border: none;" class="form-control" placeholder="组织机构代码/统一社会信用代码"
                               type="text" name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="组织机构代码/统一社会信用代码 不能为空"></td>
                </tr>
                <tr>
                    <td>账户名称</td>
                    <td><input style="border: none;" class="form-control" placeholder="账户名称" type="text"
                               name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="账户名称 不能为空"></td>
                </tr>
                <tr>
                    <td>开户银行</td>
                    <td><input style="border: none;" class="form-control" placeholder="开户银行" type="text"
                               name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="开户银行 不能为空"></td>
                </tr>
                <tr>
                    <td>账号</td>
                    <td><input style="border: none;" class="form-control" placeholder="账号" type="text"
                               name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="账号 不能为空"></td>
                </tr>
                </tbody>
                <tbody>
                <tr>
                    <td rowspan="2">丙方</td>
                    <td>项目管理联系人</td>
                    <td><input style="border: none;" class="form-control" placeholder="项目管理联系人" type="text"
                               name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="项目管理联系人 不能为空"></td>
                </tr>
                </tbody>
            </table>
            <button class="layui-btn" lay-submit lay-filter="sub1">提交</button>
        </form>
    </div>
    <div class="module">
        <form class="layui-form" id="form9">
            <table lay-even class="layui-table">
                <colgroup>
                    <col width="15%">
                    <col width="40%">
                    <col width="40%">
                </colgroup>
                <thead>
                <th class="header" colspan="3">签订合同各方联系方式</th>
                </thead>
                <tbody>
                <tr>
                    <td rowspan="6">甲方</td>
                    <td>联系人</td>
                    <td><input style="border: none;" class="form-control" placeholder="联系人" type="text"
                               name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="联系人 不能为空"></td>
                </tr>
                <tr>
                    <td>电话</td>
                    <td><input style="border: none;" class="form-control" placeholder="电话" type="text"
                               name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="电话 不能为空"></td>
                </tr>
                <tr>
                    <td>传真</td>
                    <td><input style="border: none;" class="form-control" placeholder="传真"
                               type="text" name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="传真 不能为空"></td>
                </tr>
                <tr>
                    <td>邮编</td>
                    <td><input style="border: none;" class="form-control" placeholder="邮编" type="text"
                               name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="邮编 不能为空"></td>
                </tr>
                <tr>
                    <td>地址</td>
                    <td><input style="border: none;" class="form-control" placeholder="地址" type="text"
                               name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="地址 不能为空"></td>
                </tr>
                <tr>
                    <td>E-mail(电子邮箱)</td>
                    <td><input style="border: none;" class="form-control" placeholder="E-mail(电子邮箱)" type="text"
                               name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="E-mail(电子邮箱) 不能为空"></td>
                </tr>
                </tbody>
                <tbody>
                <tr>
                    <td rowspan="6">乙方</td>
                    <td>联系人</td>
                    <td><input style="border: none;" class="form-control" placeholder="联系人" type="text"
                               name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="联系人 不能为空"></td>
                </tr>
                <tr>
                    <td>电话</td>
                    <td><input style="border: none;" class="form-control" placeholder="电话" type="text"
                               name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="电话 不能为空"></td>
                </tr>
                <tr>
                    <td>传真</td>
                    <td><input style="border: none;" class="form-control" placeholder="传真"
                               type="text" name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="传真 不能为空"></td>
                </tr>
                <tr>
                    <td>邮编</td>
                    <td><input style="border: none;" class="form-control" placeholder="邮编" type="text"
                               name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="邮编 不能为空"></td>
                </tr>
                <tr>
                    <td>地址</td>
                    <td><input style="border: none;" class="form-control" placeholder="地址" type="text"
                               name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="地址 不能为空"></td>
                </tr>
                <tr>
                    <td>E-mail(电子邮箱)</td>
                    <td><input style="border: none;" class="form-control" placeholder="E-mail(电子邮箱)" type="text"
                               name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="E-mail(电子邮箱) 不能为空"></td>
                </tr>
                </tbody>
                <tbody>
                <tr>
                    <td rowspan="6">丙方</td>
                    <td>联系人</td>
                    <td><input style="border: none;" class="form-control" placeholder="联系人" type="text"
                               name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="联系人 不能为空"></td>
                </tr>
                <tr>
                    <td>电话</td>
                    <td><input style="border: none;" class="form-control" placeholder="电话" type="text"
                               name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="电话 不能为空"></td>
                </tr>
                <tr>
                    <td>传真</td>
                    <td><input style="border: none;" class="form-control" placeholder="传真"
                               type="text" name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="传真 不能为空"></td>
                </tr>
                <tr>
                    <td>邮编</td>
                    <td><input style="border: none;" class="form-control" placeholder="邮编" type="text"
                               name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="邮编 不能为空"></td>
                </tr>
                <tr>
                    <td>地址</td>
                    <td><input style="border: none;" class="form-control" placeholder="地址" type="text"
                               name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="地址 不能为空"></td>
                </tr>
                <tr>
                    <td>E-mail(电子邮箱)</td>
                    <td><input style="border: none;" class="form-control" placeholder="E-mail(电子邮箱)" type="text"
                               name="item_name" maxlength="50" data-bv-notempty="true"
                               data-bv-notempty-message="E-mail(电子邮箱) 不能为空"></td>
                </tr>
                </tbody>
            </table>
            <button class="layui-btn" lay-submit lay-filter="sub1">提交</button>
        </form>
        <div class="form-actions">
            <div class="row" align="center">
                <div class="col-md-12">
                    <button class="btn btn-primary" onclick=" history.back(-1);">返回</button>
                    <button class="btn btn-primary" type="submit" onclick="save();">
                        <i class="fa fa-save"></i> 保存
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script type="text/javascript" src='../../../../js/constant.js'></script>
<script type="text/javascript" src="../../../../js/libs/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../../../../js/jq.js"></script>
<script type="text/javascript" src="../../../../layui/layui.js"></script>
<script type="text/javascript" src='../../../../js/common.js'></script>
<script type="text/javascript" src='../../js/serializeJson.js'></script>
<script type="text/javascript" src='../../js/initSelectData.js'></script>
<script type="text/javascript" src='../../js/saveData.js'></script>
<script>
    layui.use(['layer', 'form', 'laydate', 'upload'], function () {
        var layer = layui.layer
            , upload = layui.upload
            , form = layui.form
            , laydate = layui.laydate;
        lay('.date').each(function () {
            laydate.render({
                elem: this
                , showBottom: false
                , trigger: 'click'
            });
        });
        //监听提交
        form.on('submit(sub1)', function (data) {
            $('#sub2').trigger('click');
            return false;
        });
        form.on('submit(sub2)', function (data) {
            $('#sub3').trigger('click');
            return false;
        });
        form.on('submit(sub3)', function (data) {
            $('#sub4').trigger('click');
            return false;
        });
        form.on('submit(sub4)', function (data) {
            $('#sub5').trigger('click');
            return false;
        });
        //上面只是为了验证表单，下面才是真正的提交
        form.on('submit(sub5)', function (data) {
            saveBasics();
            addContent();
            addTarget1();
            addTarget2();
            addPersonnel();
            layer.msg("保存成功", {shift: -1, time: 1000}, function () {

            });
            return false;
        });
    });
    /*初始化数据*/
    initSelectData('planType', $('#category'));//计划类别
    initSelectData('target', $('select[name=target]'));//考核指标
    initCompanySelect();
    initProvinceSelect();
    queryDeptCode();
    initUserSelect(deptCode, $('select[name=user_id]'));

    //监听地点选择
    $(".content").on('change', '.site', function () {
        var code = $(this).val();
        var text = $(this).next().text() + $(this).find("option:selected").text() + '-';
        $(this).next().val(code);
        $(this).next().text(text);
        $(this).empty();
        $(this).append("<option value='" + code + "'>" + text + "</option>");
        var texts = text.split('-');
        if (texts.length == 2) {
            getCity(code, $(this));
        } else if (texts.length == 3) {
            getArea(code, $(this));
        } else if (texts.length == 4) {
            getStreet(code, $(this));
        }
    });

    //刷新地点选择
    function refresh(e) {
        var siteSelect = $(e).prev().prev();
        siteSelect.empty();
        siteSelect.append("<option value=''>请选择</option>");
        getProvince(siteSelect);
        siteSelect.next().val('');
        siteSelect.next().text('');
    }

    //监听人员选择
    $(".content").on('change', 'select[name=user_id]', function () {
        var usetId = $(this).val();
        queryUserInfo(usetId, $(this));
    });
    //监听负责分工
    $(".content").on('click', '.targetIds', function () {
        var thisInput = $(this);
        layui.use(['form', 'layer'], function () {
            var form = layui.form;
            var layer = layui.layer;

            index = layer.open({
                title: "负责或参与的指标",
                type: 1,
                area: ['800px', '400px'],
                btn: ['确定', '关闭'],
                yes: function (index, layero) {
                    var titles = [],vals = [];
                    $('input[name=fake]:checked').each(function () {
                        titles.push($(this).attr('title'));
                        vals.push($(this).val());
                    })
                    thisInput.val(titles);
                    thisInput.next().val(vals);
                    layer.close(index);
                },
                btn2: function (index, layero) {
                    layer.close(index);
                },
                content: '<div class="layui-form"><div class="layui-form-item">\n' +
                    '    <label class="layui-form-label">请选择</label>\n' +
                    '    <div class="layui-input-block checkbox">\n' +
                    '    </div>\n' +
                    '  </div></div>'
            });
            $("select[name=target]").each(function () {
                var val = $(this).find('option:selected').val();
                var text = $(this).find('option:selected').text();
                if(val!=''){
                    $(".checkbox").append('<input type="checkbox" name="fake" value="'+val+'" title="'+text+'">');
                }
            })
            form.render('checkbox');
        })
    });

    //保存
    function save() {
        $('#sub1').trigger('click');
        //saveBasics();
        //addContent();
    }

    //添加一行
    function add_row(e) {
        layui.use(['layer', 'form', 'laydate'], function () {
            var layer = layui.layer
                , form = layui.form
                , laydate = layui.laydate;
            var str = $(e).parent().next().find('tbody').children().last().clone(true);
            $(e).parent().next().find('tbody').append(str);
            //清空表单内容
            var lastTr = $(e).parent().next().find('tbody').children().last();
            lastTr.find('input[type=text]').val('');
            lastTr.find('input[name=district]').val('');
            lastTr.find('input[name=district]').text('');
            lastTr.find('textarea').val('');
            lastTr.find('select').val('');

            lastTr.find('button').trigger('click');
            //渲染
            lay('.date').each(function () {
                laydate.render({
                    elem: this
                    , showBottom: false
                    , trigger: 'click'
                });
                $(".date").removeAttr("lay-key");
            });
        });
    }

    //删除一行
    function del_row(e) {
        var dom = $(e).parent().next().find('tbody').children();
        if (dom.length == 1) {
            return;
        }
        $(e).parent().next().find('tbody').children().last().remove();
    }

    //添加考核指标类型
    function option_target() {
        layui.use(['form', 'laydate'], function () {
            var form = layui.form
                , laydate = layui.laydate;
            index = layer.open({
                title: "选择指标",
                btn: ['确定', '关闭'],
                type: 1,
                area: ['450px', '350px'],
                content:
                    ' <div class="form-group">'
                    + '  <label class="col-md-3 control-label">考核指标</label>'
                    + ' <div class="col-md-7">'
                    + '  <select class="form-control input-sm" id="targetType" name="type">'
                    + '  <option value=' + '' + '>- 请选择 -</option>'

                    + ' </select>'
                    + ' </div>'
                    + ' </div>',
                yes: function (index, layero) {
                    var text = $("#targetType option:selected").text();
                    var type = $("#targetType").val();
                    let str;
                    str =
                        ' <div id="classname"  class="module target">'
                        + ' <div class="layui-btn-group btn-group">'
                        + '  <button type="button" class="layui-btn layui-btn-sm" onclick="add_row(this);">'
                        + ' <i class="layui-icon">&#xe654;</i>'
                        + ' </button>'
                        + '   <button type="button" class="layui-btn layui-btn-sm" onclick="del_row(this);">'
                        + '  <i class="layui-icon">&#xe640;</i>'
                        + '</button>'
                        + ' </div>'
                        + '<table lay-even lay-skin="nob" class="layui-table">'
                        + '<colgroup>'
                        + ' <col width="30%">'
                        + ' <col width="10%">'
                        + ' <col width="20%">'
                        + '<col width="20%">'
                        + '<col width="20%">'
                        + '</colgroup>'
                        + '<thead>'
                        + ' <th class="header" colspan="5">' + text + '</th>'
                        + '<tr>'
                        + ' <td>内容</td>'
                        + ' <td>数量</td>'
                        + '<td>时间</td>'
                        + '<td>地点</td>'
                        + ' <td>人员</td>'
                        + '</tr>'
                        + ' </thead>'
                        + '<tbody>'
                        + '<tr>'
                        + '<td><input type="hidden" name="item_id">'
                        + '<input type="hidden" name="type" value="' + type + '">'
                        + '<input type="hidden" name="status" value="0">'
                        + '<select class="form-control input-sm" lay-verify="required" lay-ignore name="target">'
                        + '<option value="">请选择</option>'
                        + '</select></td>'
                        + ' <td> <input class="form-control" lay-verify="required" placeholder="数量" type="text"'
                        + ' name="count"></td>'
                        + '<td><input class="form-control date" lay-verify="required" placeholder="开始时间" type="text"'
                        + ' name="start_date">'
                        + '<input class="form-control date" lay-verify="required" placeholder="结束时间" type="text"'
                        + ' name="end_date"></td>'
                        + '<td>'
                        + '<select class="form-control input-sm site" lay-verify="required" lay-ignore>'
                        + '<option value="">请选择</option>'
                        + '</select>'
                        + '<input type="hidden" name="district">'
                        + '<button type="button" class="layui-btn layui-btn-xs" onclick="refresh(this);"'
                        + 'style="position: absolute;right: 20px;top: 50%;margin-top:-11px;background-color: #e1e1e1;">'
                        + '<i class="layui-icon">&#xe669;</i>'
                        + '</button>'
                        + ' </td>'
                        + ' <td><input class="form-control " lay-verify="required" placeholder="人员" type="text"></td>'
                        + '</tr>'
                        + ' </tbody>'
                        + '    </table>'
                        + '</div>';
                    $("#forma").append(str);
                    initSelectData('target', $("#forma").find('.module').last().find('tbody').children().find('select[name=target]'));//考核指标
                    $("#forma").find('.module').last().find('tbody').children().find('button').trigger('click');
                    //渲染
                    lay('.date').each(function () {
                        laydate.render({
                            elem: this
                            , showBottom: false
                            , trigger: 'click'
                        });

                    });
                    layer.msg("成功", {shift: -1, time: 1000}, function () {
                        layer.close(index);
                    });
                }
                , btn2: function (index, layero) {
                    layer.close(index);
                }
            });
        });
        initSelectData("targetType", $('#targetType'));
    }

    function delete_target() {
        index = layer.open({
            title: "选择要删除的指标",
            btn: ['确定', '关闭'],
            type: 1,
            area: ['450px', '350px'],
            content:
                ' <div class="form-group">'
                + '  <label class="col-md-3 control-label">考核指标</label>'
                + ' <div class="col-md-7">'
                + '  <select class="form-control input-sm" id="targetType" name="type">'
                + ' </select>'
                + ' </div>'
                + ' </div>',
            yes: function (index, layero) {
                var i = $("#targetType option:selected").val();
                var t = $(".target");
                $(t[i]).remove();
                layer.msg("成功", {shift: -1, time: 1000}, function () {
                    layer.close(index);
                });
            }, btn2: function (index, layero) {
                layer.close(index);
            }
        })
        var t = $(".target");
        $(t).each(function (index) {
            var text = $(this).find('th').text();
            $("#targetType").append('<option value=' + index + '>' + text + '</option>');
        })
    }
</script>

</html>